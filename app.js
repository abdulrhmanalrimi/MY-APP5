// =============================
// 0) ุจูุงูุงุช ุงูุทุงูุจ (ุงูููู ุงูุดุฎุตู)
// =============================

const USER_PROFILE_KEY = 'nahw-user-profile-v1';

function loadUserProfile() {
  try {
    const raw = localStorage.getItem(USER_PROFILE_KEY);
    return raw ? JSON.parse(raw) : null;
  } catch (err) {
    console.error('Error loading user profile', err);
    return null;
  }
}

function saveUserProfile(profile) {
  try {
    localStorage.setItem(USER_PROFILE_KEY, JSON.stringify(profile));
  } catch (err) {
    console.error('Error saving user profile', err);
  }
}

// =============================
// 1) ุจูุงูุงุช ุงูุฏุฑูุณ LESSONS
// =============================

const LESSONS = {
  // =========================
  // ุชุนุฑูู ุงููุญู / ุงูููุฏูุฉ
  // =========================
  'types-of-word': {
    id: 'types-of-word',
    title: 'ุฃููุงุน ุงูููุงู',
    categoryId: 'parts-of-speech',
    videos: [
      {
        title: 'ุฃููุงุน ุงููููุฉ',
        url: 'https://youtu.be/46MwuNDrdlo?si=yHVbvc0IS1QbtRft'
      }
    ],
    images: [
      'lessons/ุงููุณู%20ุงูุฃูู%20ุฃููุงุน%20ุงููููุฉ/ุฃููุงุน%20ุงููููุฉ.jpg'
    ],
    contentHtml: `
      <p>
        ุชููุณู ุงููููุฉ ูู ุงููุบุฉ ุงูุนุฑุจูุฉ ุฅูู ุซูุงุซุฉ ุฃููุงุน ุฃุณุงุณูุฉ:
        <strong>ุงุณู</strong> ู<strong>ูุนู</strong> ู<strong>ุญุฑู</strong>.
      </p>

      <h4>ุฃูููุง: ุงูุงุณู</h4>
      <p>
        ูู ูููุฉ ุชุฏู ุนูู ูุนูู ูู ููุณูุง ููุง ุชูุชุฑู ุจุฒููุ
        ูุซู: <strong>ูุญูุฏุ ุทุงูุจุฉุ ูุชุงุจุ ุดุฌุฑุฉ</strong>.
      </p>
      <p>
        ูููู ุฃู ูุฏู ุงูุงุณู ุนูู ุงูุฅูุณุงูุ ุฃู ุงูุญููุงูุ ุฃู ุงููุจุงุชุ ุฃู ุงูุฌูุงุฏุ
        ูุซู: <em>ูุญูุฏุ ุฃุณุฏุ ุนูุจุ ุณุงุนุฉ</em>.
      </p>

      <h4>ุซุงูููุง: ุงููุนู</h4>
      <p>
        ูู ูููุฉ ุชุฏู ุนูู ูุนูู ูู ููุณูุงุ ูุชูุชุฑู ุจูุงุญุฏ ูู ุงูุฃุฒููุฉ ุงูุซูุงุซุฉ:
        ุงููุงุถูุ ุฃู ุงููุถุงุฑุนุ ุฃู ุงูุฃูุฑ.
      </p>
      <ul>
        <li><strong>ุงููุนู ุงููุงุถู:</strong> ูุฏู ุนูู ุญุฏุซ ููุน ูู ุงูุฒูู ุงููุงุถูุ ูุซู: <em>ูุตุฑูุ ููููุ ุฌูุณู</em>.</li>
        <li><strong>ุงููุนู ุงููุถุงุฑุน:</strong> ูุฏู ุนูู ุญุฏุซ ููุน ุงูุขู ุฃู ูุณุชูุฑุ ูุซู: <em>ููุตุฑูุ ูุฌูุณูุ ูุฌุชูุฏู</em>.</li>
        <li><strong>ูุนู ุงูุฃูุฑ:</strong> ูุฏู ุนูู ุทูุจ ุญุฏูุซ ุงููุนู ูู ุงููุณุชูุจูุ ูุซู: <em>ุงูุตุฑูุ ุงุฌูุณูุ ุงุฌุชูุฏู</em>.</li>
      </ul>

      <h4>ุซุงูุซูุง: ุงูุญุฑู</h4>
      <p>
        ูู ูููุฉ ูุง ูุธูุฑ ูุนูุงูุง ูุงูููุง ูุญุฏูุงุ ุจู ูุชุถุญ ุจุงูุงูุชุฑุงู ูุน ุบูุฑูุงุ
        ูุซู: <strong>ููุ ุฅููุ ุนูุ ููุ ุจูุ ุซู</strong>.
      </p>
      <p>
        ูู ุฌููุฉ <strong>ุฐูุจุชู ูู ุงูุจูุช</strong> ูุง ูุชุถุญ ูุนูู <strong>ูู</strong>
        ุฅูุง ูุน ุจููุฉ ุงููููุงุช ูู ุงูุฌููุฉ.
      </p>
    `,
    quiz: [
      {
        id: 'types-q1',
        question: 'ูุง ุงูุชุนุฑูู ุงูุฃุฏู ููุงุณูุ',
        options: [
          'ูููุฉ ุชุฏู ุนูู ูุนูู ูู ููุณูุง ููุง ุชูุชุฑู ุจุฒูู',
          'ูููุฉ ุชุฏู ุนูู ูุนูู ูู ููุณูุง ูุชูุชุฑู ุจุฒูู',
          'ูููุฉ ูุง ูุธูุฑ ูุนูุงูุง ุฅูุง ูุน ุบูุฑูุง',
          'ูููุฉ ุชุฏู ุนูู ุฒูุงู ููุท'
        ],
        correctIndex: 0,
        explanation: 'ุงูุงุณู ูุฏู ุนูู ูุนูู ูู ููุณูุ ููุง ูุฑุชุจุท ุจุฒูุงู ูุนููู.'
      },
      {
        id: 'types-q2',
        question: 'ุฃููู ููุง ููู ููุนูุฏูู ูุนููุง ูุงุถููุงุ',
        options: ['ููุชุจู', 'ุงูุชุจู', 'ูุชุจู', 'ูููุชูุจูู'],
        correctIndex: 2,
        explanation: 'ุงููุนู ุงููุงุถู ูุฏู ุนูู ุญุฏุซ ููุน ูู ุงูุฒูู ุงููุงุถู ูุซู: ูุชุจู.'
      },
      {
        id: 'types-q3',
        question: 'ุฃู ุงููููุงุช ุงูุขุชูุฉ ุชูุนูุฏูู ุญุฑูููุงุ',
        options: ['ูุญูุฏ', 'ูู', 'ููู', 'ูุฌูุณ'],
        correctIndex: 1,
        explanation: 'ุงูุญุฑู ูุซู: ููุ ุฅููุ ุนูุ ูุง ูุชู ูุนูุงู ุฅูุง ูุน ุบูุฑู.'
      },
      {
        id: 'types-q4',
        question: 'ุฃููู ุฌููุฉ ูููุง ุงุณู ูุฏู ุนูู ุฌูุงุฏุ',
        options: [
          'ุฌูุณู ุงูุทุงูุจู',
          'ุทุงุฑู ุงูุนุตููุฑู',
          'ุงููุณุฑู ุงููุฃุณู',
          'ููุง ุงูุฒุฑุนู'
        ],
        correctIndex: 2,
        explanation: 'ุงููุฃุณู ุฌูุงุฏุ ุจุฎูุงู ุงูุทุงูุจ ูุงูุนุตููุฑ ูุงูุฒุฑุน.'
      },
      {
        id: 'types-q5',
        question: 'ูู ุงูุฌููุฉ: "ููุฑุฃู ุงูุทููู ุงููุตูุฉู"ุ ูููุฉ "ููุฑุฃู" ูู:',
        options: ['ุงุณู', 'ูุนู ูุถุงุฑุน', 'ุญุฑู', 'ูุนู ูุงุถ'],
        correctIndex: 1,
        explanation: 'ููุฑุฃู ูุนู ูุถุงุฑุน ูุฃูู ูุฏู ุนูู ุญุฏุซู ููุน ุงูุขู ุฃู ูุชุฌุฏุฏ.'
      },
      {
        id: 'types-q6',
        question: 'ูู ุฃููู ุงูุฌูู ุงูุชุงููุฉ ุธูุฑ ุญุฑู ูู ุญุฑูู ุงูุฌุฑุ',
        options: [
          'ุงูุทุงูุจู ูุฌุชูุฏู',
          'ูุฌุญู ูุญูุฏู',
          'ุฐูุจุชู ุฅูู ุงููุฏุฑุณุฉู',
          'ููุนุจู ุงูุฃุทูุงูู'
        ],
        correctIndex: 2,
        explanation: 'ุญุฑู ุงูุฌุฑ ููุง ูู "ุฅูู".'
      }
    ]
  },

  // ูุซุงู ูุฏุฑุณ ุชูููุฏู ุขุฎุฑ ุฅู ุงุญุชุฌุชู
  'nahw-definition-2': {
    id: 'nahw-definition-2',
    title: 'ุฏุฑุณ ุชูููุฏู ุฅุถุงูู',
    categoryId: 'parts-of-speech',
    videos: [],
    images: [],
    contentHtml: `
      <p>ููููู ูุงุญููุง ูุถุน ูุญุชูู ุชูููุฏู ุฅุถุงูู ููุง.</p>
    `,
    quiz: []
  },

  // =========================
  // ุงูุฌูู
  // =========================
  sentence: {
    id: 'sentence',
    title: 'ุงูุฌููุฉ',
    categoryId: 'sentence-parts',
    videos: [
      {
        title: 'ุงูุฌููุฉ',
        url: 'https://youtu.be/9AR0d5IUSSo?si=hr3P7QyUKslCVCh2'
      }
    ],
    images: [
      'lessons/ุงููุณู ุงูุซุงูุซ ุงูุฌููุฉ/ุงูุฌููุฉ.jpg'
    ],
    contentHtml: `
      <p>
        ุงูุฌููุฉ ูู ุงููุบุฉ ุงูุนุฑุจูุฉ ููุนุงู ุฑุฆูุณุงู:
        <strong>ุฌููุฉ ุงุณููุฉ</strong> ู<strong>ุฌููุฉ ูุนููุฉ</strong>.
      </p>

      <h4>ุฃูููุง: ุงูุฌููุฉ ุงูุงุณููุฉ</h4>
      <p>
        ูู ุงูุชู ุชุจุฏุฃ ุจุงุณูุ ูุชุชููู ุฃุณุงุณูุง ูู
        <strong>ูุจุชุฏุฃ ูุฎุจุฑ</strong>ุ
        ูุซู: <em>ุงูุนููููู ููุฑูุ ุงููุทุฑู ุบุฒูุฑู</em>.
      </p>
      <p>
        ูุฏ ูุฏุฎู ุนูู ุงูุฌููุฉ ุงูุงุณููุฉ
        <strong>ุฅููู ูุฃุฎูุงุชููุง</strong>
        ูุชูุตุจ ุงููุจุชุฏุฃ ูุชุฑูุน ุงูุฎุจุฑ:
        <em>ุฅููู ุงูููู ุฑุญูููุ ููุชู ุงูุดุจุงุจู ุนุงุฆุฏู</em>.
      </p>

      <h4>ุซุงูููุง: ุงูุฌููุฉ ุงููุนููุฉ</h4>
      <p>
        ูู ุงูุชู ุชุจุฏุฃ ุจูุนูุ ูุชุชููู ูู <strong>ูุนู ููุงุนู</strong>ุ
        ูุซู: <em>ุญุถุฑู ุงููุนูููุ ููุชุจู ุงูููุฏู</em>.
      </p>
      <p>
        ููุฏ ุชูุจูู ูููุฌููู ููููู ุงูุชุฑููุจ ูู
        <strong>ูุนู ููุงุฆุจ ูุงุนู</strong>ุ
        ูุซู: <em>ููุชุญู ุงูุจุงุจูุ ูููุชุญู ุงูุจุงุจู</em>.
      </p>

      <p>
        ูููู ููุน ุงูุฌููุฉ ูุณุงุนุฏู ุนูู ุถุจุท ุงูุฅุนุฑุงุจ
        ูุชุญุฏูุฏ ูููุน ูู ูููุฉ ุฏุงุฎู ุงูุฌููุฉ.
      </p>
    `,
    quiz: [
      {
        id: 'sent-q1',
        question: 'ุฃููู ุงูุฌูู ุงูุขุชูุฉ ุฌููุฉ ุงุณููุฉุ',
        options: [
          'ุฌูุณู ุงูุทุงูุจู',
          'ููุฑุฃู ุงูุทููู',
          'ุงููุทุฑู ุบุฒูุฑู',
          'ุณุงูุฑู ุงูุฃุจู'
        ],
        correctIndex: 2,
        explanation: 'ุงูุฌููุฉ ุงูุงุณููุฉ ุชุจุฏุฃ ุจุงุณู: "ุงููุทุฑู ุบุฒูุฑู".'
      },
      {
        id: 'sent-q2',
        question: 'ุงูููููููุงู ุงูุฃุณุงุณูุงู ููุฌููุฉ ุงูุงุณููุฉ ููุง:',
        options: [
          'ูุนู ููุงุนู',
          'ูุจุชุฏุฃ ูุฎุจุฑ',
          'ูุนู ูููุนูู ุจู',
          'ูุจุชุฏุฃ ููุถุงู ุฅููู'
        ],
        correctIndex: 1,
        explanation: 'ุงูุฌููุฉ ุงูุงุณููุฉ ุชุชููู ูู ูุจุชุฏุฃ ูุฎุจุฑ ุฃุณุงุณูุง.'
      },
      {
        id: 'sent-q3',
        question: 'ุฃููู ุฌููุฉู ูุนููุฉ ูุจููุฉ ูููุฌูููุ',
        options: [
          'ูุชุญู ุงูููุฏู ุงูุจุงุจู',
          'ููุชุจู ุงูุทุงูุจู ุงูุฏุฑุณู',
          'ููุชุญู ุงูุจุงุจู',
          'ุฃููู ุงูุทููู ุงูุชูุงุญุฉู'
        ],
        correctIndex: 2,
        explanation: 'ููุชุญู ุงูุจุงุจู: ูุนู ูุงุถู ูุจูู ูููุฌููู ููุงุฆุจ ูุงุนู.'
      },
      {
        id: 'sent-q4',
        question: 'ูู ุฌููุฉ "ุฅููู ุงูููู ุฑุญููู"ุ ูููุฉ "ุงููู" ุชุนุฑุจ:',
        options: [
          'ูุจุชุฏุฃ ูุฑููุน',
          'ุฎุจุฑ ูุฑููุน',
          'ุงุณู ุฅููู ููุตูุจ',
          'ุฎุจุฑ ุฅููู ููุตูุจ'
        ],
        correctIndex: 2,
        explanation: 'ุฅููู ุชูุตุจ ุงููุจุชุฏุฃุ ููุตุจุญ ุงุณููุง ููุตูุจูุง.'
      },
      {
        id: 'sent-q5',
        question: 'ูู ุฌููุฉ "ููุชุจู ุงูุทุงูุจู ุงูุฏุฑุณู"ุ ููุน ุงูุฌููุฉ ูู:',
        options: ['ุงุณููุฉ', 'ูุนููุฉ', 'ุดุฑุทูุฉ', 'ุงุณุชููุงููุฉ'],
        correctIndex: 1,
        explanation: 'ุงูุฌููุฉ ุจุฏุฃุช ุจูุนู ูุถุงุฑุน "ููุชุจู"ุ ููู ุฌููุฉ ูุนููุฉ.'
      },
      {
        id: 'sent-q6',
        question: 'ุฃููู ุชุฑููุจู ููุนูุฏูู ุฑูููุง ูู ุฃุฑูุงู ุงูุฌููุฉ ุงููุนููุฉุ',
        options: [
          'ูุจุชุฏุฃ ูุฎุจุฑ',
          'ูุงุนู ูููุนูู ุจู ููุท',
          'ูุนู ููุงุนู',
          'ูุนู ูุญุฑู ุฌุฑ'
        ],
        correctIndex: 2,
        explanation: 'ุงูุฑูู ุงูุฃุณุงุณู ููุฌููุฉ ุงููุนููุฉ: ูุนู ููุงุนู.'
      }
    ]
  },

  // =========================
  // ุงูุฃุณูุงุก (ุชุตูููุงุช ูุชุนุฏูุฏุฉ)
  // =========================

  // ุฃุณูุงุก ุงูุฅุดุงุฑุฉ
  demonstratives: {
    id: 'demonstratives',
    title: 'ุฃุณูุงุก ุงูุฅุดุงุฑุฉ',
    categoryId: 'built-nouns',
    videos: [
      {
        title: 'ุฃุณูุงุก ุงูุฅุดุงุฑุฉ',
        url: 'https://youtu.be/eO0c3sBP6Zg?si=Up6ALenO0749PGzc'
      }
    ],
    images: [
      'lessons/ุงุณูุงุก ุงูุฅุดุงุฑุฉ/ุงุณู ุงูุงุดุงุฑุฉ.docx'
    ],
    contentHtml: `
      <p>
        <strong>ุงุณู ุงูุฅุดุงุฑุฉ</strong>
        ูู ุงุณู ููุณุชุนูู ููุฏูุงูุฉ ุนูู ูุนูููู ุจูุงุณุทุฉ ุฅุดุงุฑุฉ ุญุณููุฉ
        ุจุงููุฏ ุฃู ุงูุนูู ูุญู ุดูุก ุญุงุถุฑ.
      </p>

      <h4>ุฃูููุง: ููููุฑุฏ ุงููุฑูุจ</h4>
      <ul>
        <li><strong>ูุฐุง</strong> ููููุฑุฏ ุงููุฐูุฑ: <em>ูุฐุง ุฑุฌููุ ูุฐุง ูุญูุฏู</em>.</li>
        <li><strong>ูุฐู</strong> ููููุฑุฏ ุงููุคูุซ: <em>ูุฐู ุงูุฑุฃุฉูุ ูุฐู ุนุงุฆุดุฉู</em>.</li>
      </ul>

      <h4>ุซุงูููุง: ูููุซููู ุงููุฑูุจ</h4>
      <ul>
        <li><strong>ูุฐุงูู</strong> ูููุซููู ุงููุฐูุฑ: <em>ูุฐุงูู ุฑุฌูุงูุ ูุฐุงูู ูุฑููุงู</em>.</li>
        <li><strong>ูุงุชุงูู</strong> ูููุซููู ุงููุคูุซ: <em>ูุงุชุงูู ุงูุฑุฃุชุงูุ ูุงุชุงูู ูุฑููุชุงูู</em>.</li>
      </ul>

      <h4>ุซุงูุซูุง: ููุฌูุน ุงููุฑูุจ</h4>
      <ul>
        <li>
          <strong>ูุคูุงุกู</strong> ูุฌูุน ุงููุฐูุฑ ูุงููุคูุซ:
          <em>ูุคูุงุกู ุฃุทูุงูุ ูุคูุงุกู ูุณูุฉูุ ูุคูุงุกู ูุชุญุงุจูููุ ูุคูุงุกู ูุคุฏูุจุงุชู</em>.
        </li>
      </ul>

      <p>
        ูุชุบููุฑ ุฅุนุฑุงุจ ุงุณู ุงูุฅุดุงุฑุฉ ุญุณุจ ูููุนู ูู ุงูุฌููุฉ
        (ูุจุชุฏุฃุ ุฎุจุฑุ ูุงุนู...) ูููู ูุจูู ูุจููููุง ูู ุฃุบูุจ ุงูุงุณุชุนูุงูุงุช.
      </p>
    `,
    quiz: [
      {
        id: 'dem-q1',
        question: 'ุฃููู ุงุณู ุฅุดุงุฑุฉ ููุงุณุจ ููุฌููุฉ: _____ ุทุงูุจุฉู ูุฌุชูุฏุฉุ',
        options: ['ูุฐุง', 'ูุฐู', 'ูุฐุงูู', 'ูุคูุงุกู'],
        correctIndex: 1,
        explanation: 'ุทุงูุจุฉ ูุคูุซ ููุฑุฏุ ูููุณุชุฎุฏู ุงุณู ุงูุฅุดุงุฑุฉ "ูุฐู".'
      },
      {
        id: 'dem-q2',
        question: 'ุงูุฌููุฉ ุงูุตุญูุญุฉ ูู:',
        options: [
          'ูุฐุง ุจูุงุชู ูุฌุชูุฏุงุชู',
          'ูุคูุงุกู ุจูุชู ูุฌุชูุฏุฉู',
          'ูุคูุงุกู ุจูุงุชู ูุฌุชูุฏุงุชู',
          'ูุฐุงูู ุจูุงุชู ูุฌุชูุฏุงุชู'
        ],
        correctIndex: 2,
        explanation: 'ุงูุฌูุน ุงููุคูุซ "ุจูุงุช" ููุงุณุจู ุงุณู ุงูุฅุดุงุฑุฉ "ูุคูุงุกู".'
      },
      {
        id: 'dem-q3',
        question: 'ุฃููู ุชุฑููุจ ุตุงุฆุจ: ูููุซููู ุงููุฐูุฑ ุงููุฑูุจุ',
        options: [
          'ูุฐุง ูุชุงุจุงูู',
          'ูุฐุงูู ูุชุงุจููู',
          'ูุฐุงูู ูุชุงุจุงูู',
          'ูุคูุงุกู ูุชุงุจุงูู'
        ],
        correctIndex: 2,
        explanation: 'ุงููุซููู ุงููุฐูุฑ: "ูุฐุงูู ูุชุงุจุงูู".'
      },
      {
        id: 'dem-q4',
        question: 'ูู ุฌููุฉ "ูุฐู ุดุฌุฑุฉู ูุซูุฑุฉู"ุ ุฅุนุฑุงุจ "ูุฐู" ุบุงูุจูุง:',
        options: [
          'ูุจุชุฏุฃ ูุจูู ูู ูุญู ุฑูุน',
          'ุฎุจุฑ ูุฑููุน',
          'ููุนูู ุจู ููุตูุจ',
          'ูุถุงู ุฅููู ูุฌุฑูุฑ'
        ],
        correctIndex: 0,
        explanation: 'ุบุงูุจูุง ููุน ุงุณู ุงูุฅุดุงุฑุฉ ูู ุฃูู ุงูุฌููุฉ ุงูุงุณููุฉ ูุจุชุฏุฃู.'
      },
      {
        id: 'dem-q5',
        question: 'ุฃููู ุงูุฌูู ุงูุชุงููุฉ ุชุญุชูู ุนูู ุงุณู ุฅุดุงุฑุฉ ููุฌูุนุ',
        options: [
          'ูุฐุง ุจูุชู ุฌูููู',
          'ูุฐู ูุฏุฑุณุฉู',
          'ูุฐุงูู ุทุงูุจุงูู',
          'ูุคูุงุกู ุทูุงุจู ูุฌุชูุฏูู'
        ],
        correctIndex: 3,
        explanation: '"ูุคูุงุกู" ููุณุชุนูู ููุฌูุน.'
      }
    ]
  },

  // ุงูุฃุณูุงุก ุงูููุตููุฉ
  'relative-pronouns': {
    id: 'relative-pronouns',
    title: 'ุงูุฃุณูุงุก ุงูููุตููุฉ',
    categoryId: 'built-nouns',
    videos: [
      {
        title: 'ุงูุฃุณูุงุก ุงูููุตููุฉ',
        url: 'https://youtu.be/tPIEgfxmDr0?si=t1ed37kxFOR77WRF'
      }
    ],
    images: [
      'lessons/ุงูุฃุณูุงุก ุงูููุตููุฉ/ุงูุฃุณูุงุก ุงูููุตููุฉ.jpg'
    ],
    contentHtml: `
      <p>
        <strong>ุงูุงุณููู ุงูููููุตูููู</strong>
        ูู ุงุณู ููุณุชุนูู ููููุณููู ูุนูููู ุจูุงุณุทุฉ ุฌููุฉ ุชูุฐูุฑ ุจุนุฏู
        ุชูุณููู <strong>ุตูุฉ ุงูููุตูู</strong>ุ ูุซู:
        <em>ุฌุงุก ุงูุฐู ูุงุฒ</em>.
      </p>

      <h4>ุฃูููุง: ุงูุฃุณูุงุก ุงูููุตููุฉ ุงููุดุชุฑูุฉ</h4>
      <p>ููุธ ูุงุญุฏ ูุณุชุนูู ููุฌููุน (ููุฑุฏุ ูุซูููุ ุฌูุนุ ูุฐูุฑุ ูุคูุซ):</p>
      <ul>
        <li><strong>ููู</strong> ููุนุงููุ ูุซู: <em>ูุฌุญ ูู ุงุฌุชูุฏ</em>.</li>
        <li><strong>ูุง</strong> ูุบูุฑ ุงูุนุงููุ ูุซู: <em>ุงูุฑุฃ ูู ุงููุชุจ ูุง ูููุฏู</em>.</li>
        <li><strong>ุฃูู</strong> ุจุญุณุจ ุงูุณูุงู ููุนุงูู ูุบูุฑูุ ูุซู: <em>ุฃูุฑูู ุฃููููู ุฃูุซุฑู ุงุฌุชูุงุฏูุง</em>.</li>
      </ul>

      <h4>ุซุงูููุง: ุงูุฃุณูุงุก ุงูููุตููุฉ ุงูุฎุงุตุฉ</h4>
      <p>ุชุชุบููุฑ ุญุณุจ ุงูุชุฐููุฑ ูุงูุชุฃููุซ ูุงูุฅูุฑุงุฏ ูุงูุชุซููุฉ ูุงูุฌูุน:</p>
      <ul>
        <li>
          ูููุฐูุฑ:
          <strong>ุงูุฐูุ ุงููุฐุงููุ ุงููุฐููุ ุงูุฐูู</strong>.
        </li>
        <li>
          ูููุคูุซ:
          <strong>ุงูุชูุ ุงููุชุงููุ ุงููุชููุ ุงููุงุชูุ ุงููุงุฆูุ ุงูููุงุชู</strong>.
        </li>
      </ul>

      <p>
        ุตูุฉ ุงูููุตูู ุชููู ุฌููุฉ ุงุณููุฉ ุฃู ูุนููุฉุ ููุง ูุญูู ููุง ูู ุงูุฅุนุฑุงุจุ
        ููููุง ุชูุชููู ูุนูู ุงูุงุณู ุงูููุตูู ูุชุญุฏูุฏ ุงูููุตูุฏ ุจู.
      </p>
    `,
    quiz: [
      {
        id: 'rel-q1',
        question: 'ูู ุฌููุฉ "ูุฌุญู ูููู ุงุฌุชูุฏู"ุ ูููุฉ "ููู" ูู:',
        options: ['ุงุณู ุงุณุชููุงู', 'ุงุณู ููุตูู ูุดุชุฑู', 'ุงุณู ุดุฑุท', 'ุถููุฑ'],
        correctIndex: 1,
        explanation: '"ููู" ููุง ุงุณู ููุตูู ูุดุชุฑู ููุณุชุฎุฏู ููุนุงูู.'
      },
      {
        id: 'rel-q2',
        question: 'ุฃููู ุฌููุฉ ุชุญูู ุงุณููุง ููุตูููุง ุฎุงุตููุง ูููุฐูุฑ ุงูููุฑุฏุ',
        options: [
          'ุฃูุฑูู ุฃููููู ุฃูุดุทู',
          'ุฌุงุก ุงูุฐู ูุงุฒู ุจุงููุณุงุจูุฉู',
          'ูุฌุญ ูู ุงุฌุชูุฏ',
          'ูุฐุง ูุง ุฃูุญุจู'
        ],
        correctIndex: 1,
        explanation: '"ุงูุฐู" ุงุณู ููุตูู ุฎุงุตู ูููุฐูุฑ ุงูููุฑุฏ.'
      },
      {
        id: 'rel-q3',
        question: 'ูู ุฌููุฉ "ูุฑุฃุชู ูุง ูููุนูู"ุ ููุน "ูุง" ูู:',
        options: ['ุงุณู ุงุณุชููุงู', 'ุงุณู ููุตูู ูุบูุฑ ุงูุนุงูู', 'ุญุฑู ููู', 'ุญุฑู ุฌุฑ'],
        correctIndex: 1,
        explanation: '"ูุง" ููุง ุงุณู ููุตูู ูุบูุฑ ุงูุนุงูู.'
      },
      {
        id: 'rel-q4',
        question: 'ุงูุฌููุฉ ุงูุชู ุชุตูุญ ุฃู ุชููู ุตูุฉ ููุตูู ูู:',
        options: [
          'ูู ุงููุฏุฑุณุฉู',
          'ุงูุฐู ูุงุฒู',
          'ุญุถุฑู ูุจูุฑูุง',
          'ููุฐู ุฒููู ุจุนูุฏู'
        ],
        correctIndex: 2,
        explanation: 'ุตูุฉ ุงูููุตูู ุฌููุฉ ุชุงูุฉ: ูุนู ููุงุนู ูุซูุงู "ุญุถุฑู ูุจูุฑูุง".'
      },
      {
        id: 'rel-q5',
        question: 'ุฃููู ุงูุฃุณูุงุก ุงูุชุงููุฉ ูู ุงูุฃุณูุงุก ุงูููุตููุฉ ุงูุฎุงุตุฉ ูููุคูุซุ',
        options: ['ูู', 'ูุง', 'ุงูุชู', 'ุฃูู'],
        correctIndex: 2,
        explanation: '"ุงูุชู" ูู ุงูุฃุณูุงุก ุงูููุตููุฉ ุงูุฎุงุตุฉ ุจุงูููุฑุฏ ุงููุคูุซ.'
      }
    ]
  },

  // ุงูุฃุณูุงุก ุงูุฎูุณุฉ
  'five-nouns': {
    id: 'five-nouns',
    title: 'ุงูุฃุณูุงุก ุงูุฎูุณุฉ',
    categoryId: 'secondary-case-signs',
    videos: [
      {
        title: 'ุงูุฃุณูุงุก ุงูุฎูุณุฉ',
        url: 'https://youtu.be/Ao6gfEK177o?si=IO3W-EWf7nZHpn41'
      }
    ],
    images: [
      'lessons/ุงูุฃุณูุงุก ุงูุฎูุณุฉ/ุงูุฃุณูุงุก ุงูุฎูุณุฉ.jpg',
      'lessons/ุงูุฃุณูุงุก ุงูุฎูุณุฉ/ุงูุฃุณูุงุก ุงูุฎูุณุฉ 1.jpg'
    ],
    contentHtml: `
      <p>
        <strong>ุงูุฃุณูุงุก ุงูุฎูุณุฉ</strong> ูู:
        <strong>ุฃุจููุ ุฃุฎููุ ุญูููุ ูููุ ุฐู ูุงูู</strong>.
        ูุชูุชุงุฒ ุจุฃู ุฅุนุฑุงุจูุง ูููู ุจุงูุญุฑูู ููุงุจุฉู ุนู ุงูุญุฑูุงุช ูู ุญุงูุงุช ูุนูููุฉ.
      </p>

      <h4>ุฅุนุฑุงุจ ุงูุฃุณูุงุก ุงูุฎูุณุฉ</h4>
      <ul>
        <li><strong>ุชุฑูุน ุจุงููุงู</strong>: <em>ุฌุงุก ุฃุจููุ ุฒุงุฑูุง ุฃุฎููุ ูุฐุง ุฐู ูุงูู</em>.</li>
        <li><strong>ุชูุตุจ ุจุงูุฃูู</strong>: <em>ุฑุฃูุช ุฃุจุงูุ ุตุงุฏูุช ุฃุฎุงูุ ุฃูุฑูุช ุญูุงู</em>.</li>
        <li><strong>ุชูุฌุฑู ุจุงููุงุก</strong>: <em>ูุฑุฑุช ุจุฃุจููุ ุณููุช ุนูู ุฃุฎููุ ุฌูุณุช ุฅูู ุญููู</em>.</li>
      </ul>

      <h4>ุดุฑูุท ุฅุนุฑุงุจูุง ุจูุฐุง ุงูุฅุนุฑุงุจ</h4>
      <ul>
        <li>ุฃู ุชููู <strong>ููุฑุฏุฉ</strong>ุ ูุฅุฐุง ุซููููุช ุฃู ุฌููุนุช ุฃูุนุฑุจุช ุฅุนุฑุงุจ ุงููุซููู ุฃู ุงูุฌูุน.</li>
        <li>ุฃู ุชููู <strong>ูุถุงูุฉ</strong>ุ ููุง ุชูุนุฑุจ ูุฐุง ุงูุฅุนุฑุงุจ ุฅุฐุง ููุทุนุช ุนู ุงูุฅุถุงูุฉ.</li>
        <li>ุฃู ุชุถุงู ุฅูู <strong>ุบูุฑ ูุงุกู ุงููุชูููู</strong>ุ ูุฅุฐุง ุฃูุถููุช ุฅูู ูุงุก ุงููุชูููู (ุฃุจูุ ุฃุฎู) ุนุงุฏุช ุฅูู ุงูุฅุนุฑุงุจ ุจุงูุญุฑูุงุช.</li>
      </ul>

      <p>
        ุฅุฐุง ุงุฎุชูู ูุงุญุฏ ูู ูุฐู ุงูุดุฑูุท ุนุงุฏุช ุงูุฃุณูุงุก ุงูุฎูุณุฉ ุฅูู ุงูุฅุนุฑุงุจ ุจุงูุญุฑูุงุช
        ุนูู ุงูุญุฑู ุงูุฃุฎูุฑ ูุซู ุณุงุฆุฑ ุงูุฃุณูุงุก.
      </p>
    `,
    quiz: [
      {
        id: 'five-q1',
        question: 'ุฃููู ููุง ููู ููุนูุฏูู ูู ุงูุฃุณูุงุก ุงูุฎูุณุฉุ',
        options: ['ุฃุจูู', 'ุฃุฎููุง', 'ุฃุจุงูุง', 'ุฃุจููู'],
        correctIndex: 0,
        explanation: 'ุงูุตูุบุฉ ุงูุฃุตููุฉ ูู ุงูุฃุณูุงุก ุงูุฎูุณุฉ: ุฃุจููุ ุฃุฎููุ ุญูููุ ูููุ ุฐู.'
      },
      {
        id: 'five-q2',
        question: 'ูู ุฌููุฉ "ุฌุงุก ุฃุจูู"ุ ุนูุงูุฉ ุฑูุน "ุฃุจูู" ูู:',
        options: ['ุงูุถูุฉ', 'ุงููุงู', 'ุงูุฃูู', 'ุงููุงุก'],
        correctIndex: 1,
        explanation: 'ุงูุฃุณูุงุก ุงูุฎูุณุฉ ุชูุฑูุน ุจุงููุงู.'
      },
      {
        id: 'five-q3',
        question: 'ูู ุฌููุฉ "ุฑุฃูุชู ุฃุจุงู"ุ ุนูุงูุฉ ูุตุจ "ุฃุจุงู" ูู:',
        options: ['ุงููุชุญุฉ', 'ุงูุถูุฉ', 'ุงูุฃูู', 'ุงููุงุก'],
        correctIndex: 2,
        explanation: 'ุชูุตุจ ุงูุฃุณูุงุก ุงูุฎูุณุฉ ุจุงูุฃูู.'
      },
      {
        id: 'five-q4',
        question: 'ูู ุฌููุฉ "ูุฑุฑุชู ุจุฃุจูู"ุ ุนูุงูุฉ ุฌุฑ "ุฃุจูู" ูู:',
        options: ['ุงููุณุฑุฉ', 'ุงููุชุญุฉ', 'ุงููุงุก', 'ุงููุงู'],
        correctIndex: 2,
        explanation: 'ุชูุฌุฑู ุงูุฃุณูุงุก ุงูุฎูุณุฉ ุจุงููุงุก.'
      },
      {
        id: 'five-q5',
        question: 'ุฃููู ุงูุฌูู ุงูุชุงููุฉ ุงุฎุชู ูููุง ุดุฑุท ูู ุดุฑูุท ุงูุฃุณูุงุก ุงูุฎูุณุฉุ',
        options: [
          'ุฒุงุฑูู ุฃุฎูู',
          'ุฌุงุก ุฃุจูู',
          'ุฃูุฑูุชู ุญูู',
          'ุงุญุชุฑูุชู ุฐุง ุนููู'
        ],
        correctIndex: 2,
        explanation: 'ุนูุฏ ุฅุถุงูุชูุง ููุงุก ุงููุชููู (ุญูู) ุชุนูุฏ ููุฅุนุฑุงุจ ุจุงูุญุฑูุงุช ูุง ุจุงูุญุฑูู.'
      }
    ]
  },

  // =========================
  // ุงูุฃุณุงููุจ ุงููุญููุฉ
  // =========================

  // ุฃุณููุจ ุงูุงุณุชููุงู / ุฃุฏูุงุช ุงูุงุณุชููุงู
  interrogatives: {
    id: 'interrogatives',
    title: 'ุฃุณููุจ ุงูุงุณุชููุงู',
    categoryId: 'interrogative-style',
    videos: [
      {
        title: 'ุฃุฏูุงุช ุงูุงุณุชููุงู',
        url: 'https://youtu.be/fY-y8LqX6Bk?si=LU1wqp5iTMB_YQOB'
      }
    ],
    images: [
      'lessons/ุฃุณููุจ ุงูุงุณุชููุงู/ุฃุฏูุงุช ุงูุงุณุชููุงู.jpg'
    ],
    contentHtml: `
      <p>
        <strong>ุฃุณููุจ ุงูุงุณุชููุงู</strong> ููุณุชุนูู ูุทูุจ ุงูููู ุฃู ุงูุงุณุชุนูุงู ุนู ุดูุก ูุฌููู
        ุนูุฏ ุงููุชููููุ ูููู ุฃุฏุงุฉ ููู ูุนูู ุฎุงุต ูููุน ูุนููู ูู ุงูุณุคุงู.
      </p>

      <h4>ุฃูู ุฃุฏูุงุช ุงูุงุณุชููุงู ููุนุงูููุง</h4>
      <ul>
        <li><strong>ููู</strong> โ ููุณุคุงู ุนู <strong>ุงูุนุงูู</strong>:
          <em>ููู ุขุฎุฑู ุงูุฎููุงุกู ุงูุฑุงุดุฏููุ</em></li>
        <li><strong>ูุง / ูุงุฐุง</strong> โ ููุณุคุงู ุนู <strong>ุบูุฑ ุงูุนุงูู</strong> ุฃู ุงูุฃุดูุงุก:
          <em>ูุง ุฃุญุจูู ุงูุนูููู ุฅูููุ</em></li>
        <li><strong>ูุชู</strong> โ ููุณุคุงู ุนู <strong>ุงูุฒูุงู</strong>:
          <em>ูุชู ุฑุฌุนุชุ</em></li>
        <li><strong>ุฃูุงู</strong> โ ููุฒูุงู ุงููุณุชูุจู:
          <em>ุฃูุงู ุชูุณุงูุฑุ</em></li>
        <li><strong>ุฃูู</strong> โ ููุณุคุงู ุนู <strong>ุงูููุงู</strong>:
          <em>ุฃูู ุฃุฎููุ</em></li>
        <li><strong>ููู</strong> โ ููุณุคุงู ุนู <strong>ุงูุญุงู</strong> ุฃู ุงูููุฆุฉ:
          <em>ููู ุญุงูููุ</em></li>
        <li><strong>ูู</strong> โ ููุณุคุงู ุนู <strong>ุงูุนุฏุฏ</strong>:
          <em>ูู ูุชุงุจูุง ูุฑุฃุชุ</em></li>
        <li><strong>ุฃููู</strong> โ ููุณุคุงู ุนู <strong>ุชุนููู</strong> ูุงุญุฏ ูู ูุฌููุนุฉ:
          <em>ุฃููู ุฑุฌูู ุฃุชูุ</em></li>
      </ul>

      <p>
        ุงุฎุชูุงุฑ ุฃุฏุงุฉ ุงูุงุณุชููุงู ุงูููุงุณุจุฉ ูุนุทู ุณุคุงูู ุฏูุฉู ููุถูุญูุงุ
        ููุณุงุนุฏู ุนูู ููู ุงููุตูุต ุงููุฑุขููุฉ ูุงููุบููุฉ ููููุง ุฃูุถู.
      </p>
    `,
    quiz: [
      {
        id: 'int-q1',
        question: 'ุฃููู ุฃุฏุงุฉ ุงุณุชููุงู ุชูุณุชุฎุฏู ููุณุคุงู ุนู ุงูุนุงููุ',
        options: ['ูุง', 'ุฃูู', 'ููู', 'ูู'],
        correctIndex: 2,
        explanation: 'ุชุณุชุนูู "ููู" ููุณุคุงู ุนู ุงูุนุงูู.'
      },
      {
        id: 'int-q2',
        question: 'ุงูุณุคุงู ุงูููุงุณุจ ุนู ุงูุฒูุงู ูู:',
        options: [
          'ุฃูู ุชุฏุฑุณุ',
          'ูุชู ุชุจุฏุฃู ุงูุญุตุฉูุ',
          'ููู ุญุงูููุ',
          'ูู ูุชุงุจูุง ูุฑุฃุชุ'
        ],
        correctIndex: 1,
        explanation: '"ูุชู" ุชุฎุชุต ุจุงูุณุคุงู ุนู ุงูุฒูุงู.'
      },
      {
        id: 'int-q3',
        question: 'ุฃููู ุณุคุงูู ูุณุชุฎุฏู ุฃุฏุงุฉ ุงุณุชููุงู ุนู ุงูููุงูุ',
        options: [
          'ูุชู ุฑุฌุนุชุ',
          'ุฃูู ุชุณููุ',
          'ูู ุทุงูุจูุง ูู ุงูุตูุ',
          'ููู ูุตูุชุ'
        ],
        correctIndex: 1,
        explanation: '"ุฃูู ุชุณููุ" ุณุคุงู ุนู ุงูููุงู.'
      },
      {
        id: 'int-q4',
        question: 'ูู ุงูุฌููุฉ "ูู ุทุงูุจูุง ูู ุงูุตูุ"ุ ุฃุฏุงุฉ ุงูุงุณุชููุงู ุชูุณุชุฎุฏู ููุณุคุงู ุนู:',
        options: ['ุงูุฒูุงู', 'ุงูููุงู', 'ุงูุญุงู', 'ุงูุนุฏุฏ'],
        correctIndex: 3,
        explanation: '"ูู" ููุณุคุงู ุนู ุงูุนุฏุฏ ุฃู ุงููููุฉ.'
      },
      {
        id: 'int-q5',
        question: 'ุฃููู ุณุคุงูู ููุงุณุจ ููุณุคุงู ุนู ุญุงู ุงูุดุฎุตุ',
        options: [
          'ูุชู ุญุถุฑุชุ',
          'ุฃูู ุชูููุ',
          'ููู ุตุญุชููุ',
          'ูู ูุฑุฉู ุฒุฑุชูุงุ'
        ],
        correctIndex: 2,
        explanation: '"ููู" ุชูุณุชุฎุฏู ููุณุคุงู ุนู ุงูุญุงู ุฃู ุงูููุฆุฉ.'
      }
    ]
  },

  // =========================
  // ุงูุชูุงุจุน / ุฃุญูุงู ุฃุฎุฑู
  // =========================
  tamyeez: {
    id: 'tamyeez',
    title: 'ุงูุชูููุฒ',
    categoryId: 'mansubat',
    videos: [],
    images: [
      'lessons/ุงูุชูููุฒ/ุงูุชูููุฒ.jpg'
    ],
    contentHtml: `
      <p>
        <strong>ุงูุชูููุฒ</strong> ุงุณู ููุฑุฉ ููุตูุจ ูุฃุชู ููููุฒูู ุฅุจูุงููุง ูู ุงูุฌููุฉ
        ููููุถูุญ ุงูููุตูุฏ ูู ูููุฉ ูุจููุ
        ูุซู: <em>ุงุดุชุฑูุชู ูููู ุณููุฑูุง</em>ุ ููููุฉ <strong>ุณูุฑูุง</strong> ุชูููุฒ.
      </p>

      <h4>ุฃููุงุน ุงูุชูููุฒ</h4>

      <h5>1- ุชูููุฒ ููููุธ</h5>
      <p>
        ููุถูุญ ููุฏุงุฑูุง ูุฐููุฑูุง ูุจููุ ูุซู ุงูุนุฏุฏ ุฃู ุงูููู ุฃู ุงููุฒู ุฃู ุงููุณุงุญุฉ:
      </p>
      <ul>
        <li>ุชูููุฒ ุงูุนุฏุฏ: <em>ูุนู ุฎูุณุฉู ุฑูุงูุงุชู</em>.</li>
        <li>ุชูููุฒ ุงูููู: <em>ุดุฑุจุชู ูุชุฑูุง ูุงุกู</em>.</li>
        <li>ุชูููุฒ ุงููุฒู: <em>ุงุดุชุฑูุชู ูููู ูุญููุง</em>.</li>
        <li>ุชูููุฒ ุงููุณุงุญุฉ: <em>ุฒุฑุนุชู ูุฏุงููุง ููุญูุง</em>.</li>
      </ul>

      <h5>2- ุชูููุฒ ููุญูุธ (ููุณุจุฉ)</h5>
      <p>
        ููุถูุญ ุฌููุฉู ุฃู ูุณุจุฉู ูุนูููุฉู ูุจููุ ูุซู:
        <em>ุทุงุจู ุงูุฌููู ููุงุกู</em>ุ
        <em>ุงุฒุฏุงุฏู ุงูุทุงูุจู ุนูููุง</em>.
      </p>

      <p>
        ูุนุฑูุฉ ููุน ุงูุชูููุฒ ุชุณุงุนุฏ ุนูู ููู ุงูุฌููุฉ ูุถุจุท ุฅุนุฑุงุจูุง ุจุฏููุฉ.
      </p>
    `,
    quiz: [
      {
        id: 'tam-q1',
        question: 'ุงูุชูููุฒ ูู ุฌููุฉ "ุงุดุชุฑูุชู ูููู ุณููุฑูุง" ูู:',
        options: ['ูููู', 'ุงุดุชุฑูุชู', 'ุณูุฑูุง', 'ูู'],
        correctIndex: 2,
        explanation: '"ุณูุฑูุง" ุชูููุฒ ููุถูุญ ููุน ุงูููุฏุงุฑ (ูููู).'
      },
      {
        id: 'tam-q2',
        question: 'ูู ุฌููุฉ "ูุนู ุฎูุณุฉู ุฑูุงูุงุชู"ุ ููุน ุงูุชูููุฒ ูู:',
        options: ['ุชูููุฒ ูุฒู', 'ุชูููุฒ ุนุฏุฏ', 'ุชูููุฒ ูุณุงุญุฉ', 'ุชูููุฒ ุญุงู'],
        correctIndex: 1,
        explanation: 'ุฎูุณุฉู ุฑูุงูุงุชู: ุชูููุฒ ุนุฏุฏ.'
      },
      {
        id: 'tam-q3',
        question: 'ุฃููู ุฌููุฉ ูููุง ุชูููุฒ ููุญูุธ (ูุณุจุฉ)ุ',
        options: [
          'ุดุฑุจุชู ูุชุฑูุง ูุงุกู',
          'ุงุดุชุฑูุชู ูููู ุฃุฑุฒูุง',
          'ุทุงุจู ุงูุฌููู ููุงุกู',
          'ุฒุฑุนุชู ูุฏุงููุง ููุญูุง'
        ],
        correctIndex: 2,
        explanation: '"ุทุงุจ ุงูุฌููู ููุงุกู" ููุถูุญ ุญุงูุฉ ุงูุฌูุ ููุฐุง ุชูููุฒ ููุญูุธ.'
      },
      {
        id: 'tam-q4',
        question: 'ูุง ุชุนุฑูู ุงูุชูููุฒุ',
        options: [
          'ุงุณู ูุนุฑูุฉ ููุถูุญ ุงููุงุนู',
          'ุงุณู ููุฑุฉ ูุฑููุน ูุฒูู ุฅุจูุงููุง',
          'ุงุณู ููุฑุฉ ููุตูุจ ูุฒูู ุฅุจูุงููุง ูู ุงูุฌููุฉ',
          'ูุนู ูุงุถู ูุฒูู ุงูุบููุถ'
        ],
        correctIndex: 2,
        explanation: 'ุงูุชุนุฑูู ุงูุตุญูุญ: ุงุณู ููุฑุฉ ููุตูุจ ูุฒูู ุฅุจูุงููุง.'
      },
      {
        id: 'tam-q5',
        question: 'ูู ุฌููุฉ "ุงุฒุฏุงุฏู ุงูุทุงูุจู ุนูููุง"ุ ูููุฉ "ุนูููุง" ูู:',
        options: ['ูุงุนู', 'ููุนูู ุจู', 'ุญุงู', 'ุชูููุฒ'],
        correctIndex: 3,
        explanation: '"ุนูููุง" ุชูููุฒ ููุญูุธ ููุถุญ ููุน ุงูุฒูุงุฏุฉ.'
      }
    ]
  },

  // =========================
  // ุฃูุณุงู ุงูุฌููุฉ (ุฑูุน/ูุตุจ/ุฌุฒู ุงููุถุงุฑุนุ ุงููุงุนูุ ูุงุฆุจ ุงููุงุนูุ ุงูุฃูุนุงู ุงูุฎูุณุฉ)
  // =========================
  'present-raf': {
    id: 'present-raf',
    title: 'ุฑูุน ุงููุนู ุงููุถุงุฑุน',
    categoryId: 'sentence-parts',
    videos: [],
    images: [],
    contentHtml: `
      <p>
        ููุฑูุน ุงููุนู ุงููุถุงุฑุน ุฅุฐุง ุฎูุง ูู ุงููุงุตุจ ูุงูุฌุงุฒูุ
        ูุนูุงูุฉ ุฑูุนู ุงูุถูุฉ ุงูุธุงูุฑุฉ ุฃู ุงูููุฏุฑุฉุ
        ุฃู ุซุจูุช ุงูููู ูู ุงูุฃูุนุงู ุงูุฎูุณุฉ.
      </p>
    `,
    quiz: []
  },
  'present-nasb': {
    id: 'present-nasb',
    title: 'ูุตุจ ุงููุนู ุงููุถุงุฑุน',
    categoryId: 'sentence-parts',
    videos: [],
    images: [],
    contentHtml: `
      <p>
        ููุตุจ ุงููุถุงุฑุน ุจุฃุฏูุงุช ุงููุตุจ ูุซู: ุฃูุ ููุ ููุ ุญุชู.
        ุนูุงูุฉ ูุตุจู ุงููุชุญุฉ ุงูุธุงูุฑุฉ ุฃู ุงูููุฏุฑุฉุ
        ุฃู ุญุฐู ุงูููู ูู ุงูุฃูุนุงู ุงูุฎูุณุฉ.
      </p>
    `,
    quiz: []
  },
  'present-jazm': {
    id: 'present-jazm',
    title: 'ุฌุฒู ุงููุนู ุงููุถุงุฑุน',
    categoryId: 'sentence-parts',
    videos: [],
    images: [],
    contentHtml: `
      <p>
        ูุฌุฒู ุงููุถุงุฑุน ุจุฃุฏูุงุช ุงูุฌุฒู ูุซู: ููุ ููุงุ ูุงู ุงูุฃูุฑุ ูุง ุงููุงููุฉ.
        ุนูุงูุฉ ุฌุฒูู ุงูุณูููุ ุฃู ุญุฐู ุญุฑู ุงูุนูุฉุ
        ุฃู ุญุฐู ุงูููู ูู ุงูุฃูุนุงู ุงูุฎูุณุฉ.
      </p>
    `,
    quiz: []
  },
  subject: {
    id: 'subject',
    title: 'ุงููุงุนู',
    categoryId: 'sentence-parts',
    videos: [],
    images: [],
    contentHtml: `
      <p>
        ุงููุงุนู ุงุณู ูุฑููุน ูุฏู ุนูู ูู ูุงู ุจุงููุนู ุฃู ุงุชุตู ุจูุ
        ููุฃุชู ุจุนุฏ ุงููุนู ูุจุงุดุฑุฉู ุบุงูุจูุง.
      </p>
    `,
    quiz: []
  },
  'deputy-subject': {
    id: 'deputy-subject',
    title: 'ูุงุฆุจ ุงููุงุนู',
    categoryId: 'sentence-parts',
    videos: [],
    images: [],
    contentHtml: `
      <p>
        ูุงุฆุจ ุงููุงุนู ุงุณู ูุฑููุน ูุญู ูุญู ุงููุงุนู ุนูุฏ ุจูุงุก ุงููุนู ูููุฌูููุ
        ูุซู: <em>ููุชูุจู ุงูุฏุฑุณู</em>.
      </p>
    `,
    quiz: []
  },
  'five-verbs': {
    id: 'five-verbs',
    title: 'ุงูุฃูุนุงู ุงูุฎูุณุฉ',
    categoryId: 'sentence-parts',
    videos: [],
    images: [],
    contentHtml: `
      <p>
        ุงูุฃูุนุงู ุงูุฎูุณุฉ ูู ูู ูุถุงุฑุน ุงุชุตูุช ุจู ุฃูู ุงูุงุซููู ุฃู ูุงู ุงูุฌูุงุนุฉ ุฃู ูุงุก ุงููุฎุงุทุจุฉ.
        ุชูุฑูุน ุจุซุจูุช ุงููููุ ูุชูุตุจ ูุชุฌุฒู ุจุญุฐููุง.
      </p>
    `,
    quiz: []
  },

  // =========================
  // ุงูุฃุณูุงุก ุงููุจููุฉ ูุงูุถูุงุฆุฑ
  // =========================
  pronouns: {
    id: 'pronouns',
    title: 'ุงูุถููุฑ',
    categoryId: 'built-nouns',
    videos: [],
    images: [],
    contentHtml: `
      <p>
        ุงูุถููุฑ ุงุณู ูุจูู ูุฏู ุนูู ุงููุชููู ุฃู ุงููุฎุงุทุจ ุฃู ุงูุบุงุฆุจุ
        ููุณุชุนูู ุงุฎุชุตุงุฑูุง ูุชุฌูุจูุง ููุชูุฑุงุฑ.
      </p>
    `,
    quiz: []
  },
  'address-pronouns': {
    id: 'address-pronouns',
    title: 'ุถูุงุฆุฑ ุงูุฎุทุงุจ',
    categoryId: 'built-nouns',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุถูุงุฆุฑ ุงูุฎุทุงุจ ุชุดูุฑ ุฅูู ุงููุฎุงุทูุจ ูุซู: ุฃูุชูุ ุฃูุชูุ ุฃูุชูุงุ ุฃูุชูุ ุฃูุชู.</p>
    `,
    quiz: []
  },
  'absent-pronouns': {
    id: 'absent-pronouns',
    title: 'ุถูุงุฆุฑ ุงูุบุงุฆุจ',
    categoryId: 'built-nouns',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุถูุงุฆุฑ ุงูุบุงุฆุจ ุชุดูุฑ ุฅูู ุบูุฑ ุงูุญุงุถุฑ ูุซู: ููุ ููุ ููุงุ ููุ ูู.</p>
    `,
    quiz: []
  },
  'speaker-pronouns': {
    id: 'speaker-pronouns',
    title: 'ุถูุงุฆุฑ ุงููุชููู',
    categoryId: 'built-nouns',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุถูุงุฆุฑ ุงููุชููู ุชุดูุฑ ูููุชููู ููุณู ูุซู: ุฃูุงุ ูุญู.</p>
    `,
    quiz: []
  },

  // =========================
  // ุนูุงูุงุช ุงูุฅุนุฑุงุจ ุงููุฑุนูุฉ
  // =========================
  dual: {
    id: 'dual',
    title: 'ุงููุซูู',
    categoryId: 'secondary-case-signs',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุงููุซูู ุงุณู ูุฏู ุนูู ุงุซูููุ ูุฑูุน ุจุงูุฃูู ูููุตุจ ููุฌุฑ ุจุงููุงุก.</p>
    `,
    quiz: []
  },
  'masculine-sound-plural': {
    id: 'masculine-sound-plural',
    title: 'ุฌูุน ูุฐูุฑ ุณุงูู',
    categoryId: 'secondary-case-signs',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุฌูุน ุงููุฐูุฑ ุงูุณุงูู ูุฑูุน ุจุงููุงู ูููุตุจ ููุฌุฑ ุจุงููุงุกุ ููุตุงุบ ุจุฒูุงุฏุฉ ูุงู ูููู ุฃู ูุงุก ูููู.</p>
    `,
    quiz: []
  },
  'feminine-sound-plural': {
    id: 'feminine-sound-plural',
    title: 'ุฌูุน ูุคูุซ ุณุงูู',
    categoryId: 'secondary-case-signs',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุฌูุน ุงููุคูุซ ุงูุณุงูู ูุฑูุน ุจุงูุถูุฉ ูููุตุจ ููุฌุฑ ุจุงููุณุฑุฉุ ููุตุงุบ ุจุฒูุงุฏุฉ ุฃูู ูุชุงุก.</p>
    `,
    quiz: []
  },

  // =========================
  // ุงูููุงุณุฎ
  // =========================
  kana: {
    id: 'kana',
    title: 'ูุงู ูุฃุฎูุงุชูุง',
    categoryId: 'nawasikh',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุชุฏุฎู ูุงู ูุฃุฎูุงุชูุง ุนูู ุงูุฌููุฉ ุงูุงุณููุฉ ูุชุฑูุน ุงููุจุชุฏุฃ ุงุณููุง ููุง ูุชูุตุจ ุงูุฎุจุฑ ุฎุจุฑูุง ููุง.</p>
    `,
    quiz: []
  },
  kada: {
    id: 'kada',
    title: 'ูุงุฏ ูุฃุฎูุงุชูุง',
    categoryId: 'nawasikh',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุฃูุนุงู ุงูููุงุฑุจุฉ ูุซู ูุงุฏ ูุฃูุดู ุชุนูู ุนูู ูุงู ููู ุฎุจุฑูุง ูููู ุฌููุฉ ูุนููุฉ ูุถุงุฑุนุฉ.</p>
    `,
    quiz: []
  },
  dhanna: {
    id: 'dhanna',
    title: 'ุธู ูุฃุฎูุงุชูุง',
    categoryId: 'nawasikh',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุชุฏุฎู ุฃูุนุงู ุงูุธู ุนูู ุงูุฌููุฉ ุงูุงุณููุฉ ูุชูุตุจ ุงููุจุชุฏุฃ ูุงูุฎุจุฑ ููุนูููู ููุง.</p>
    `,
    quiz: []
  },
  inna: {
    id: 'inna',
    title: 'ุฅู ูุฃุฎูุงุชูุง',
    categoryId: 'nawasikh',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุญุฑูู ุฅู ูุฃุฎูุงุชูุง ุชูุตุจ ุงููุจุชุฏุฃ ูุชุฑูุน ุงูุฎุจุฑุ ูุชููุฏ ูุนุงูู ุงูุชุฃููุฏ ุฃู ุงูุชููู ูุบูุฑูุง.</p>
    `,
    quiz: []
  },

  // =========================
  // ุงูููุตูุจุงุช
  // =========================
  object: {
    id: 'object',
    title: 'ุงูููุนูู ุจู',
    categoryId: 'mansubat',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุงูููุนูู ุจู ุงุณู ููุตูุจ ูุฏู ุนูู ูู ููุน ุนููู ูุนู ุงููุงุนู.</p>
    `,
    quiz: []
  },
  haal: {
    id: 'haal',
    title: 'ุงูุญุงู',
    categoryId: 'mansubat',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุงูุญุงู ุงุณู ููุตูุจ ูุจูู ููุฆุฉ ุตุงุญุจู ููุช ูููุน ุงููุนู.</p>
    `,
    quiz: []
  },

  // =========================
  // ุงูุชูุงุจุน
  // =========================
  naat: {
    id: 'naat',
    title: 'ุงููุนุช',
    categoryId: 'tawabi',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุงููุนุช ุชุงุจุน ูุตู ุงูููุนูุช ููุชุจุนู ูู ุงูุฅุนุฑุงุจ.</p>
    `,
    quiz: []
  },
  badal: {
    id: 'badal',
    title: 'ุงูุจุฏู',
    categoryId: 'tawabi',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุงูุจุฏู ุชุงุจุน ููุถุญ ุงูููุตูุฏ ูู ุงููุชุจูุน ุฃู ูุณุชุฏุฑูู.</p>
    `,
    quiz: []
  },
  atf: {
    id: 'atf',
    title: 'ุงูุนุทู',
    categoryId: 'tawabi',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุงูุนุทู ุชุงุจุน ูุชูุณุท ุจููู ูุจูู ูุชุจูุนู ุญุฑู ุนุทูุ ููุชุจุนู ูู ุงูุฅุนุฑุงุจ.</p>
    `,
    quiz: []
  },
  tawkeed: {
    id: 'tawkeed',
    title: 'ุงูุชูููุฏ',
    categoryId: 'tawabi',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุงูุชูููุฏ ุชุงุจุน ููุฑุฑ ุงููุนูู ููุฏูุน ุงูุดู ุจุงุณุชุฎุฏุงู ุฃููุงุธ ูุซู ููุณ ููู ุฃู ุฃููุงุธ ูุนูููุฉ.</p>
    `,
    quiz: []
  },

  // =========================
  // ุงููุฌุฑูุฑุงุช
  // =========================
  'huruf-jar': {
    id: 'huruf-jar',
    title: 'ุญุฑูู ุงูุฌุฑ',
    categoryId: 'majrurat',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุญุฑูู ุงูุฌุฑ ุชุฎูุถ ุงูุงุณู ุจุนุฏูุง ูุชุฑุจุท ุจููู ูุจูู ูุง ูุจูู ุฏูุงูุฉู ููุนููู.</p>
    `,
    quiz: []
  },
  'ism-majrur': {
    id: 'ism-majrur',
    title: 'ุงูุงุณู ุงููุฌุฑูุฑ',
    categoryId: 'majrurat',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุงูุงุณู ุงููุฌุฑูุฑ ูู ุงูุงุณู ุงูุฐู ุณุจูู ุญุฑู ุฌุฑ ุฃู ุฃุถูู ุฅูู ุงุณู ุขุฎุฑุ ูุนูุงูุชู ุงููุณุฑุฉ ุฃู ูุง ูููุจ ุนููุง.</p>
    `,
    quiz: []
  },
  'mudaf-ilayh': {
    id: 'mudaf-ilayh',
    title: 'ุงููุถุงู ุฅููู',
    categoryId: 'majrurat',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุงููุถุงู ุฅููู ุงุณู ูุฌุฑูุฑ ูุจููู ููููุฉ ุฃู ุชุฎุตูุตูุง ููุง ูุจูู ููุฃุชู ุจุนุฏ ุงุณู ูุถุงู.</p>
    `,
    quiz: []
  },

  // =========================
  // ุฎุทูุงุช ูุซูุงุจุช ูููุงุฐุฌ ุงูุฅุนุฑุงุจ
  // =========================
  'i3rab-steps': {
    id: 'i3rab-steps',
    title: 'ุฎุทูุงุช ุงูุฅุนุฑุงุจ',
    categoryId: 'i3rab-steps',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุฎุทูุงุช ุงูุฅุนุฑุงุจ ุชุชุถูู ุชุญุฏูุฏ ููุน ุงููููุฉุ ูุนูุงูุฉ ุงูุฅุนุฑุงุจุ ูุณุจุจูุงุ ูููุถุนูุง ูู ุงูุฌููุฉ.</p>
    `,
    quiz: []
  },
  'i3rab-constants': {
    id: 'i3rab-constants',
    title: 'ุซูุงุจุช ุฅุนุฑุงุจูุฉ',
    categoryId: 'i3rab-constants',
    videos: [],
    images: [],
    contentHtml: `
      <p>ุซูุงุจุช ุงูุฅุนุฑุงุจ ูู ููุงุนุฏ ูุง ุชุชุบูุฑ ูุซู ุจูุงุก ุงูุญุฑูู ูุจุนุถ ุงูุฃุณูุงุก ุงููุจููุฉ.</p>
    `,
    quiz: []
  },
  'i3rab-models': {
    id: 'i3rab-models',
    title: 'ููุงุฐุฌ ุฅุนุฑุงุจูุฉ',
    categoryId: 'i3rab-models',
    videos: [],
    images: [],
    contentHtml: `
      <p>ููุงุฐุฌ ุฅุนุฑุงุจูุฉ ูุฎุชุตุฑุฉ ูุขูุงุช ูุฃูุซูุฉ ุชุทุจูููุฉ ุชุณุงุนุฏ ุนูู ุชุฑุณูุฎ ุงูููุงุนุฏ.</p>
    `,
    quiz: []
  }

  // โฆ ููููู ุฅุถุงูุฉ ุจููุฉ ุงูุฏุฑูุณ ููุง ุจููุณ ุงูุจููุฉ ุฅู ุฃุญุจุจุช โฆ
};


// =============================
// 2) ุงูุชุตูููุงุช CATEGORIES
// =============================

const CATEGORIES = [
  {
    id: 'parts-of-speech',
    title: 'ุฃูุณุงู ุงูููุงู',
    color: '#dcfce7',
    lessonIds: ['types-of-word']
  },
  {
    id: 'sentence-parts',
    title: 'ุฃูุณุงู ุงูุฌููุฉ',
    color: '#fef3c7',
    lessonIds: [
      'present-raf',
      'present-nasb',
      'present-jazm',
      'subject',
      'deputy-subject',
      'five-verbs'
    ]
  },
  {
    id: 'built-nouns',
    title: 'ุงูุฃุณูุงุก ุงููุจููุฉ',
    color: '#e0f2fe',
    lessonIds: [
      'demonstratives',
      'relative-pronouns',
      'pronouns',
      'address-pronouns',
      'absent-pronouns',
      'speaker-pronouns'
    ]
  },
  {
    id: 'secondary-case-signs',
    title: 'ุนูุงูุงุช ุงูุฅุนุฑุงุจ ุงููุฑุนูุฉ',
    color: '#fef9c3',
    lessonIds: ['five-nouns', 'dual', 'masculine-sound-plural', 'feminine-sound-plural']
  },
  {
    id: 'nawasikh',
    title: 'ุงูููุงุณุฎ',
    color: '#fee2e2',
    lessonIds: ['kana', 'kada', 'dhanna', 'inna']
  },
  {
    id: 'mansubat',
    title: 'ุงูููุตูุจุงุช',
    color: '#fde68a',
    lessonIds: ['object', 'haal', 'tamyeez']
  },
  {
    id: 'tawabi',
    title: 'ุงูุชูุงุจุน',
    color: '#fae8ff',
    lessonIds: ['naat', 'badal', 'atf', 'tawkeed']
  },
  {
    id: 'majrurat',
    title: 'ุงููุฌุฑูุฑุงุช',
    color: '#cffafe',
    lessonIds: ['huruf-jar', 'ism-majrur', 'mudaf-ilayh']
  },
  {
    id: 'interrogative-style',
    title: 'ุฃุณููุจ ุงูุงุณุชููุงู',
    color: '#e0f2fe',
    lessonIds: ['interrogatives']
  },
  {
    id: 'i3rab-steps',
    title: 'ุฎุทูุงุช ุงูุฅุนุฑุงุจ',
    color: '#dcfce7',
    lessonIds: ['i3rab-steps']
  },
  {
    id: 'i3rab-constants',
    title: 'ุซูุงุจุช ุฅุนุฑุงุจูุฉ',
    color: '#e9d5ff',
    lessonIds: ['i3rab-constants']
  },
  {
    id: 'i3rab-models',
    title: 'ููุงุฐุฌ ุฅุนุฑุงุจูุฉ',
    color: '#f3e8ff',
    lessonIds: ['i3rab-models']
  }
];

// =============================
// 3) ุฃุณุฆูุฉ ููุงูุฉ ูู ุฏุฑุณ QUIZZES
// =============================

// ููููุฏ ุฃุณุฆูุฉ ุงูุงุฎุชุจุงุฑุงุช ูุจุงุดุฑุฉ ูู ูุตูููุฉ quiz ุฏุงุฎู ูู ุฏุฑุณ
// ุญุชู ูุง ููุฑุฑ ุงูุจูุงูุงุช ูู ููุงููู.

const QUIZZES = {};
Object.keys(LESSONS).forEach((id) => {
  const lesson = LESSONS[id];
  if (lesson.quiz && Array.isArray(lesson.quiz) && lesson.quiz.length) {
    QUIZZES[id] = {
      questions: lesson.quiz.map((q) => ({
        text: q.question,
        options: q.options,
        correctIndex: q.correctIndex
      }))
    };
  }
});

// =============================
// 4) ุญุงูุฉ ุงูุชุทุจูู (ุชูุฏูู + ููุงุญุธุงุช + ููุถูุฉ + ูุชุงุฆุฌ ุงุฎุชุจุงุฑุงุช)
// =============================

const STORAGE_KEY = 'nahw-bisatate-state-v2';

let appState = {
  completedLessons: {}, // lessonId: true
  notes: {}, // lessonId: 'text'
  favorites: {}, // lessonId: true
  points: 0,
  quizResults: [] // ูุตูููุฉ ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑุงุช (0-100)
};

function loadState() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return;
    const parsed = JSON.parse(raw);
    if (parsed.completedLessons) appState.completedLessons = parsed.completedLessons;
    if (parsed.notes) appState.notes = parsed.notes;
    if (parsed.favorites) appState.favorites = parsed.favorites;
    if (typeof parsed.points === 'number') appState.points = parsed.points;
    if (Array.isArray(parsed.quizResults)) appState.quizResults = parsed.quizResults;
  } catch (err) {
    console.warn('ุชุนุฐุฑ ูุฑุงุกุฉ ุงูุญุงูุฉ ูู ุงูุชุฎุฒูู', err);
  }
}

function saveState() {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(appState));
  } catch (err) {
    console.warn('ุชุนุฐุฑ ุญูุธ ุงูุญุงูุฉ ูู ุงูุชุฎุฒูู', err);
  }
}

function getProgress() {
  const allIds = Object.keys(LESSONS);
  let completed = 0;
  allIds.forEach((id) => {
    if (appState.completedLessons[id]) completed++;
  });
  return { completed, total: allIds.length };
}

function getAverageQuizScore() {
  const arr = appState.quizResults || [];
  if (!arr.length) return null;
  const sum = arr.reduce((s, v) => s + v, 0);
  return Math.round(sum / arr.length);
}

function getCategoryStats() {
  return CATEGORIES.map((cat) => {
    const total = cat.lessonIds.filter((id) => LESSONS[id]).length;
    const completed = cat.lessonIds.filter(
      (id) => LESSONS[id] && appState.completedLessons[id]
    ).length;
    const percent = total ? Math.round((completed / total) * 100) : 0;
    return {
      id: cat.id,
      title: cat.title,
      total,
      completed,
      percent
    };
  });
}

function toggleFavorite(lessonId) {
  if (appState.favorites[lessonId]) {
    delete appState.favorites[lessonId];
  } else {
    appState.favorites[lessonId] = true;
  }
  saveState();
}

// =============================
// 5) ุงูุซูู + ุญุฌู ุงูุฎุท
// =============================

let fontScale = 1;

function cycleFontSize() {
  fontScale += 0.1;
  if (fontScale > 1.3) fontScale = 0.9;
  document.documentElement.style.setProperty(
    '--lesson-font-scale',
    String(fontScale)
  );
}

function toggleTheme() {
  const root = document.documentElement;
  const isDark = root.getAttribute('data-theme') === 'dark';
  root.setAttribute('data-theme', isDark ? 'light' : 'dark');
}

// =============================
// 6) ุจูุงุก ุงูู App Shell
// =============================

function buildAppShell() {
  const appRoot = document.getElementById('app-root');
  if (!appRoot) return;

  appRoot.innerHTML = `
    <div class="app-shell">
      <header class="topbar">
        <div class="topbar-left">
          <button id="btn-theme" class="icon-btn" title="ุงููุถุน ุงููููู">๐</button>
        </div>
        <div class="topbar-title">ุงููุญู ุจุจุณุงุทุฉ</div>
        <div class="topbar-right">
          <button id="btn-text-size" class="icon-btn" title="ุชุบููุฑ ุญุฌู ุงูุฎุท">T</button>
        </div>
      </header>

      <main id="view-lessons" class="view active"></main>
      <main id="view-stats" class="view"></main>
      <main id="view-ask" class="view"></main>
      <main id="view-leaders" class="view"></main>

      <nav class="bottombar">
        <button class="tab-btn active" data-view="lessons">ุงูุฏุฑูุณ</button>
        <button class="tab-btn" data-view="stats">ุงูุฅุญุตุงุฆูุงุช</button>
        <button class="tab-btn" data-view="ask">ุงุณุฃู ุงููุนูู</button>
        <button class="tab-btn" data-view="leaders">ุงููุชุตุฏุฑูู</button>
      </nav>
    </div>
  `;

  attachShellEvents();
  renderLessonsHome();
}

function attachShellEvents() {
  const btnTextSize = document.getElementById('btn-text-size');
  const btnTheme = document.getElementById('btn-theme');

  if (btnTextSize) btnTextSize.addEventListener('click', cycleFontSize);
  if (btnTheme) btnTheme.addEventListener('click', toggleTheme);

  document.querySelectorAll('.bottombar .tab-btn').forEach((btn) => {
    btn.addEventListener('click', () => {
      const view = btn.dataset.view;
      switchView(view);
    });
  });
}

function switchView(viewId) {
  document.querySelectorAll('.view').forEach((view) => {
    view.classList.toggle('active', view.id === 'view-' + viewId);
  });

  document.querySelectorAll('.bottombar .tab-btn').forEach((btn) => {
    btn.classList.toggle('active', btn.dataset.view === viewId);
  });

  if (viewId === 'lessons') {
    renderLessonsHome();
  } else if (viewId === 'stats') {
    renderStatsView();
  } else if (viewId === 'ask') {
    renderAskTeacherView();
  } else if (viewId === 'leaders') {
    renderLeadersView();
  }
}

// =============================
// 7) ูุงุฌูุฉ ูุงุฆูุฉ ุงูุฏุฑูุณ
// =============================

function renderLessonRow(lessonId) {
  const lesson = LESSONS[lessonId];
  if (!lesson) return '';
  const isCompleted = !!appState.completedLessons[lessonId];
  const isFavorite = !!appState.favorites[lessonId];
  const hasVideo = lesson.videos && lesson.videos.length > 0;

  return `
    <li class="lesson-row" data-lesson-id="${lessonId}">
      <div class="lesson-row-main">
        <span class="lesson-title">${lesson.title}</span>
        <button
          class="favorite-toggle"
          data-lesson-id="${lessonId}"
          aria-label="ุชุจุฏูู ุงูููุถูุฉ"
          style="border:none;background:transparent;font-size:1.1rem;cursor:pointer;">
          ${isFavorite ? 'โ' : 'โ'}
        </button>
      </div>
      <div class="lesson-row-meta">
        ${hasVideo ? '<span>๐ฅ ูุญุชูู ููุฏูู</span>' : ''}
        ${isCompleted ? '<span> ยท ููุชูู โ</span>' : ''}
      </div>
    </li>
  `;
}

function renderLessonsHome() {
  const view = document.getElementById('view-lessons');
  if (!view) return;

  const progress = getProgress();

  let html = `
    <header class="app-header">
      <h2>ุฏุฑูุณ ุงููุญู</h2>
      <p>ุงุฎุชุฑ ุงูุชุตููู ูุงูุฏุฑุณ ุงูุฐู ุชุฑูุฏ ุงูุจุฏุก ุจู.</p>
    </header>

    <section class="card">
      <strong>ุชูุฏููู ุงูุนุงู:</strong>
      <p>ุงูุฏุฑูุณ ุงูููุชููุฉ: ${progress.completed} ูู ${progress.total}</p>
    </section>
  `;

  CATEGORIES.forEach((cat, index) => {
    const catLessons = cat.lessonIds.filter((id) => LESSONS[id]);
    const completedInCat = catLessons.filter(
      (id) => appState.completedLessons[id]
    ).length;
    const bodyHiddenClass = index === 0 ? '' : 'hidden';

    html += `
      <article class="card category-card" style="background:${cat.color};">
        <button class="category-header" data-cat-id="${cat.id}">
          <div>
            <h3>${cat.title}</h3>
            <p>${catLessons.length} ุฏุฑุณ โ ููุชูู: ${completedInCat}</p>
          </div>
          <span>โผ</span>
        </button>
        <div class="category-body ${bodyHiddenClass}" data-cat-body="${cat.id}">
          <ul class="lessons-list">
            ${catLessons.map((id) => renderLessonRow(id)).join('')}
          </ul>
        </div>
      </article>
    `;
  });

  view.innerHTML = html;

  // ูุชุญ / ุฅุบูุงู ุงูุชุตููู
  document.querySelectorAll('.category-header').forEach((btn) => {
    btn.addEventListener('click', () => {
      const catId = btn.dataset.catId;
      const body = document.querySelector(
        `.category-body[data-cat-body="${catId}"]`
      );
      if (!body) return;
      body.classList.toggle('hidden');
    });
  });

  // ูุชุญ ุตูุญุฉ ุงูุฏุฑุณ
  document.querySelectorAll('.lesson-row').forEach((row) => {
    row.addEventListener('click', () => {
      const lessonId = row.dataset.lessonId;
      renderLessonDetail(lessonId);
    });
  });

  // ุชุจุฏูู ุงูููุถูุฉ ูู ุงููุงุฆูุฉ
  document.querySelectorAll('.favorite-toggle').forEach((btn) => {
    btn.addEventListener('click', (ev) => {
      ev.stopPropagation();
      const lessonId = btn.dataset.lessonId;
      toggleFavorite(lessonId);
      renderLessonsHome();
    });
  });
}

// =============================
// 8) HTML ูุณู ุงูุงุฎุชุจุงุฑ ููู ุฏุฑุณ
// =============================

function getQuizHtmlForLesson(lessonId) {
  const quiz = QUIZZES[lessonId];
  if (!quiz || !quiz.questions || !quiz.questions.length) {
    return `
      <section class="card">
        <h3>ุงุฎุชุจุฑ ููุณู</h3>
        <p>ุณูุชู ุฅุถุงูุฉ ุฃุณุฆูุฉ ุชูุงุนููุฉ ููุฐุง ุงูุฏุฑุณ ูุงุญููุง.</p>
      </section>
    `;
  }

  return `
    <section class="card" id="quiz-section">
      <h3>ุงุฎุชุจุฑ ููุณู</h3>
      <div id="quiz-container"></div>
    </section>
  `;
}

function setupQuizHandlers(lessonId) {
  const quiz = QUIZZES[lessonId];
  if (!quiz || !quiz.questions || !quiz.questions.length) return;

  const container = document.getElementById('quiz-container');
  if (!container) return;

  let currentIndex = 0;
  let correctCount = 0;
  let selectedIndex = null;

  function renderQuestion() {
    const q = quiz.questions[currentIndex];
    selectedIndex = null;

    container.innerHTML = `
      <div class="quiz-header">
        <p class="quiz-counter">ุงูุณุคุงู ${currentIndex + 1} ูู ${
      quiz.questions.length
    }</p>
        <p class="quiz-text">${q.text}</p>
      </div>
      <div class="quiz-options">
        ${q.options
          .map(
            (opt, i) => `
          <button class="quiz-option" data-index="${i}">${opt}</button>
        `
          )
          .join('')}
      </div>
      <button class="primary-btn quiz-confirm" id="quiz-confirm">
        ุชุฃููุฏ ุงูุฅุฌุงุจุฉ
      </button>
      <p class="quiz-feedback" id="quiz-feedback"></p>
    `;

    container.querySelectorAll('.quiz-option').forEach((btn) => {
      btn.addEventListener('click', () => {
        selectedIndex = Number(btn.dataset.index);
        container
          .querySelectorAll('.quiz-option')
          .forEach((b) => b.classList.remove('selected'));
        btn.classList.add('selected');
      });
    });

    container.querySelector('#quiz-confirm').addEventListener('click', () => {
      if (selectedIndex === null) {
        alert('ุงุฎุชุฑ ุฅุฌุงุจุฉ ุฃููุงู โ');
        return;
      }
      const feedbackEl = document.getElementById('quiz-feedback');
      const isCorrect =
        selectedIndex === quiz.questions[currentIndex].correctIndex;

      if (isCorrect) {
        correctCount++;
        feedbackEl.textContent = 'ุฅุฌุงุจุฉ ุตุญูุญุฉ ๐';
        feedbackEl.className = 'quiz-feedback correct';
      } else {
        feedbackEl.textContent = 'ุฅุฌุงุจุฉ ุฎุงุทุฆุฉุ ุฌุฑูุจ ูู ุงูุณุคุงู ุงูุชุงูู ๐';
        feedbackEl.className = 'quiz-feedback wrong';
      }

      setTimeout(() => {
        if (currentIndex < quiz.questions.length - 1) {
          currentIndex++;
          renderQuestion();
        } else {
          finishQuiz();
        }
      }, 700);
    });
  }

  function finishQuiz() {
    const total = quiz.questions.length;
    const percent = Math.round((correctCount / total) * 100);

    container.innerHTML = `
      <p>ุงูุชูู ุงูุงุฎุชุจุงุฑ! โจ</p>
      <p>ูุชูุฌุชู: <strong>${correctCount}</strong> ูู <strong>${total}</strong> (${percent}ูช)</p>
      <button class="primary-btn" id="quiz-retry">ุฅุนุงุฏุฉ ุงููุญุงููุฉ</button>
    `;

    // ุญูุธ ุงููุชูุฌุฉ ูู ุงูุฅุญุตุงุฆูุงุช
    if (!Array.isArray(appState.quizResults)) appState.quizResults = [];
    appState.quizResults.push(percent);
    appState.points += Math.round(percent / 20); // ููุงูุฃุฉ ุจุณูุทุฉ ุญุณุจ ุงููุชูุฌุฉ
    saveState();

    const retryBtn = document.getElementById('quiz-retry');
    if (retryBtn) {
      retryBtn.addEventListener('click', () => {
        currentIndex = 0;
        correctCount = 0;
        renderQuestion();
      });
    }
  }

  renderQuestion();
}

// =============================
// 9) ุตูุญุฉ ุชูุงุตูู ุงูุฏุฑุณ
// =============================

function renderLessonDetail(lessonId) {
  const lesson = LESSONS[lessonId];
  const view = document.getElementById('view-lessons');
  if (!lesson || !view) return;

  const isCompleted = !!appState.completedLessons[lessonId];
  const notes = appState.notes[lessonId] || '';
  const isFavorite = !!appState.favorites[lessonId];

  let imagesHtml = '';
  if (lesson.images && lesson.images.length) {
    imagesHtml = `
      <section class="card">
        <h3>ุตูุฑ ุชูุถูุญูุฉ</h3>
        ${lesson.images
          .map(
            (src) => `
              <figure class="lesson-image">
                <img src="${src}" alt="${lesson.title}" />
              </figure>
            `
          )
          .join('')}
      </section>
    `;
  }

  let videosHtml = '';
  if (lesson.videos && lesson.videos.length) {
    videosHtml = `
      <section class="card">
        <h3>ุงูููุฏูููุงุช ุงูุชูุถูุญูุฉ</h3>
        <ul class="videos-list">
          ${lesson.videos
            .map(
              (v) => `
                <li>
                  <strong>${v.title}</strong><br />
                  <a href="${v.url}" target="_blank" rel="noopener">ูุดุงูุฏุฉ ุนูู ููุชููุจ</a>
                </li>
              `
            )
            .join('')}
        </ul>
      </section>
    `;
  }

  const quizHtml = getQuizHtmlForLesson(lessonId);

  view.innerHTML = `
    <button class="primary-btn" id="back-to-lessons" style="margin-bottom:0.8rem;">
      โ ุงูุนูุฏุฉ ุฅูู ุงูุฏุฑูุณ
    </button>

    <section class="card">
      <div class="lesson-detail-header" style="display:flex;align-items:center;justify-content:space-between;gap:0.5rem;">
        <h2 style="margin:0;">${lesson.title}</h2>
        <button
          id="favorite-detail-toggle"
          aria-label="ุชุจุฏูู ุงูููุถูุฉ"
          style="border:none;background:transparent;font-size:1.4rem;cursor:pointer;">
          ${isFavorite ? 'โ' : 'โ'}
        </button>
      </div>
    </section>

    ${imagesHtml}

    <section class="card lesson-content">
      <h3>ูุญุชูู ุงูุฏุฑุณ</h3>
      ${
        lesson.contentHtml && lesson.contentHtml.trim()
          ? lesson.contentHtml
          : '<p>ุณูุชู ุฅุถุงูุฉ ุงููุญุชูู ุงูุชูุตููู ููุฐุง ุงูุฏุฑุณ ูุงุญููุง.</p>'
      }
    </section>

    ${videosHtml}

    ${quizHtml}

    <section class="card">
      <h3>ุชุญููู ุงูุฏุฑุณ</h3>
      <p class="muted">ุณูุชู ูุชุญ ูุงูุฐุฉ ุงูุทุจุงุนุฉุ ูููููู ุงุฎุชูุงุฑ "ุญูุธ ูููู PDF" ูู ุงููุชุตูุญ.</p>
      <button class="primary-btn" id="download-pdf">
        ุชุญููู ุงูุฏุฑุณ ุจุตูุบุฉ PDF
      </button>
    </section>

    <section class="card">
      <h3>ููุงุญุธุงุชู ุงูุดุฎุตูุฉ</h3>
      <textarea id="notes-text" rows="4" style="width:100%;">${notes}</textarea>
      <button class="primary-btn" id="save-notes" style="margin-top:0.4rem;">
        ุญูุธ ุงูููุงุญุธุงุช
      </button>
    </section>

    <section class="card">
      <h3>ุญุงูุฉ ุงูุฏุฑุณ</h3>
      <p>ุงูุญุงูุฉ ุงูุญุงููุฉ: ${isCompleted ? 'โ ููุชูู' : 'ูู ูููููู ุจุนุฏ'}</p>
      <button class="primary-btn" id="toggle-complete">
        ${isCompleted ? 'ุฅุฒุงูุฉ ุนูุงูุฉ ุงูุฅููุงู' : 'ูุถุน ุนูุงูุฉ ุฏุฑุณ ููุชูู'}
      </button>
    </section>
  `;

  // ุชูุนูู ุงูุงุฎุชุจุงุฑ
  setupQuizHandlers(lessonId);

  // ุฒุฑ ุงูุนูุฏุฉ ูุน ููุฏุงู ุฌููู
  document
    .getElementById('back-to-lessons')
    .addEventListener('click', () => {
      showExitConfirmModal(() => {
        renderLessonsHome();
      });
    });

  // ุญูุธ ุงูููุงุญุธุงุช
  document.getElementById('save-notes').addEventListener('click', () => {
    const textarea = document.getElementById('notes-text');
    appState.notes[lessonId] = textarea.value;
    saveState();
    alert('ุชู ุญูุธ ููุงุญุธุงุชู โ');
  });

  // ุชุจุฏูู ุญุงูุฉ ุงูุฅููุงู
  document.getElementById('toggle-complete').addEventListener('click', () => {
    appState.completedLessons[lessonId] = !appState.completedLessons[lessonId];
    if (appState.completedLessons[lessonId]) {
      appState.points += 10;
    } else {
      appState.points = Math.max(0, appState.points - 10);
    }
    saveState();
    renderLessonDetail(lessonId);
  });

  // ุชุจุฏูู ุงูููุถูุฉ ูู ุตูุญุฉ ุงูุฏุฑุณ
  const favBtn = document.getElementById('favorite-detail-toggle');
  if (favBtn) {
    favBtn.addEventListener('click', () => {
      toggleFavorite(lessonId);
      renderLessonDetail(lessonId);
    });
  }

  // ุชุญููู PDF
  const downloadBtn = document.getElementById('download-pdf');
  if (downloadBtn) {
    downloadBtn.addEventListener('click', () => {
      downloadLessonPdf(lessonId);
    });
  }
}

// ุฅูุดุงุก ูุงูุฐุฉ ููุทุจุงุนุฉ / ุงูุญูุธ ูู PDF
function downloadLessonPdf(lessonId) {
  const lesson = LESSONS[lessonId];
  if (!lesson) return;

  const html = `
    <!doctype html>
    <html lang="ar" dir="rtl">
      <head>
        <meta charset="utf-8" />
        <title>${lesson.title}</title>
        <style>
          body {
            font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
            line-height: 1.8;
            padding: 24px;
          }
          h1 {
            text-align: center;
            margin-bottom: 18px;
          }
          h2, h3 {
            margin-top: 18px;
          }
          p, li {
            font-size: 16px;
          }
          ul {
            padding-right: 20px;
          }
        </style>
      </head>
      <body>
        <h1>${lesson.title}</h1>
        ${
          lesson.contentHtml && lesson.contentHtml.trim()
            ? lesson.contentHtml
            : '<p>ุณูุชู ุฅุถุงูุฉ ูุญุชูู ูุฐุง ุงูุฏุฑุณ ูุงุญููุง.</p>'
        }
      </body>
    </html>
  `;

  const printWindow = window.open('', '_blank');
  if (!printWindow) {
    alert('ุชุนุฐุฑ ูุชุญ ูุงูุฐุฉ ุฌุฏูุฏุฉุ ูุฏ ูููู ุงููุชุตูุญ ุญุธุฑ ุงูููุงูุฐ ุงูููุจุซูุฉ.');
    return;
  }
  printWindow.document.open();
  printWindow.document.write(html);
  printWindow.document.close();
  printWindow.focus();

  printWindow.onload = function () {
    printWindow.print();
  };
}

// =============================
// 10) ุงูุดุงุฑุงุช ูุงูุฅูุฌุงุฒุงุช
// =============================

function getBadges(overall, percent) {
  const favoritesCount = Object.keys(appState.favorites).length;
  const avgScore = getAverageQuizScore();

  return [
    {
      id: 'first-lesson',
      title: 'ุฃูู ุฎุทูุฉ',
      description: 'ุฅููุงู ุฃูู ุฏุฑุณ ูู ุงูุชุทุจูู.',
      unlocked: overall.completed >= 1
    },
    {
      id: 'ten-lessons',
      title: 'ูุญุจู ุงููุญู',
      description: 'ุฅููุงู 10 ุฏุฑูุณ ุฃู ุฃูุซุฑ.',
      unlocked: overall.completed >= 10
    },
    {
      id: 'half-way',
      title: 'ูุตู ุงูุทุฑูู',
      description: 'ุงููุตูู ุฅูู 50ูช ูู ุงูุฏุฑูุณ.',
      unlocked: percent >= 50
    },
    {
      id: 'full-progress',
      title: 'ููุฉ ุงูุฅุชูุงู',
      description: 'ุฅููุงู ุฌููุน ุงูุฏุฑูุณ ุงููุชุงุญุฉ.',
      unlocked: overall.total > 0 && percent === 100
    },
    {
      id: 'points-100',
      title: 'ูุฌุชูุฏ',
      description: 'ุงูุญุตูู ุนูู 100 ููุทุฉ ุฃู ุฃูุซุฑ.',
      unlocked: appState.points >= 100
    },
    {
      id: 'favorites-3',
      title: 'ุนุงุดู ุงูุฏุฑูุณ',
      description: 'ุฅุถุงูุฉ 3 ุฏุฑูุณ ุนูู ุงูุฃูู ุฅูู ุงูููุถูุฉ.',
      unlocked: favoritesCount >= 3
    },
    {
      id: 'quiz-master',
      title: 'ูุญุชุฑู ุงูุงุฎุชุจุงุฑุงุช',
      description: 'ุงููุตูู ุฅูู ูุชูุณุท 80ูช ูู ุงูุงุฎุชุจุงุฑุงุช.',
      unlocked: avgScore !== null && avgScore >= 80
    }
  ];
}

// =============================
// 11) ุตูุญุฉ ุงูุฅุญุตุงุฆูุงุช ุงููุชูุฏูุฉ
// =============================

function renderStatsView() {
  const view = document.getElementById('view-stats');
  if (!view) return;

  const { completed, total } = getProgress();
  const percent = total ? Math.round((completed / total) * 100) : 0;
  const favoritesCount = Object.keys(appState.favorites).length;
  const avgScore = getAverageQuizScore();
  const catStats = getCategoryStats();
  const badges = getBadges({ completed, total }, percent);
  const unlockedBadges = badges.filter((b) => b.unlocked).length;

  const canDownloadCertificate = percent >= 60; // ุงููุณุจุฉ ุงููุทููุจุฉ ููุดูุงุฏุฉ

  view.innerHTML = `
    <header class="app-header">
      <h2>ุฅุญุตุงุฆูุงุชู</h2>
      <p>ุชุงุจุน ุชูุฏููู ูู ุชุนููู ุงููุญู ูู ุฎูุงู ูุฐู ุงูููุญุฉ ุงูุชูุงุนููุฉ.</p>
    </header>

    <!-- ุงูุชูุฏู ุงูุนุงู -->
    <section class="card">
      <h3>ุงูุชูุฏูู ุงูุนุงู</h3>
      <p>ุงูุฏุฑูุณ ุงูููุชููุฉ: <strong>${completed}</strong> ูู <strong>${total}</strong> (${percent}ูช)</p>
      <p>ุงูููุงุท ุงูููุชุณุจุฉ: <strong>${appState.points}</strong></p>
      <p>ูุชูุณุท ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑุงุช:
        <strong>${
          avgScore === null ? 'ูุง ุชูุฌุฏ ูุชุงุฆุฌ ููุงุฎุชุจุงุฑุงุช ุจุนุฏ.' : avgScore + 'ูช'
        }</strong>
      </p>
      <div class="progress-bar">
        <span style="width:${percent}%;"></span>
      </div>
    </section>

    <!-- ุงูุฑุณูู ุงูุจูุงููุฉ ุญุณุจ ุงูุชุตููู -->
    <section class="card">
      <h3>ุงูุชูุฏูู ุญุณุจ ุงูุชุตููู</h3>
      <div class="stats-bars">
        ${catStats
          .map(
            (cat) => `
          <div class="stats-bar-row">
            <div class="stats-bar-label">${cat.title}</div>
            <div class="stats-bar-track">
              <span style="width:${cat.percent}%;"></span>
            </div>
            <div class="stats-bar-value">
              ${cat.completed}/${cat.total} (${cat.percent}ูช)
            </div>
          </div>
        `
          )
          .join('')}
      </div>
    </section>

    <!-- ุงูุดุงุฑุงุช -->
    <section class="card">
      <h3>ุงูุฅูุฌุงุฒุงุช ูุงูุดุงุฑุงุช</h3>
      <p>ุงูุดุงุฑุงุช ุงูููุชูุญุฉ: <strong>${unlockedBadges}</strong> ูู ${
    badges.length
  }</p>
      <div class="badges-grid">
        ${badges
          .map(
            (b) => `
          <div class="badge-card ${
            b.unlocked ? 'badge-unlocked' : 'badge-locked'
          }">
            <div class="badge-icon">${b.unlocked ? '๐' : '๐'}</div>
            <div class="badge-title">${b.title}</div>
            <div class="badge-desc">${b.description}</div>
          </div>
        `
          )
          .join('')}
      </div>
    </section>

    <!-- ูุนูููุงุช ุงูููุถูุฉ -->
    <section class="card">
      <h3>ุงูููุถูุฉ</h3>
      <p>ุนุฏุฏ ุงูุฏุฑูุณ ูู ุงูููุถูุฉ: <strong>${favoritesCount}</strong></p>
      <p class="muted">ุงุณุชุฎุฏู ุงูููุถูุฉ ูุญูุธ ุงูุฏุฑูุณ ุงูุชู ุชุฑูุฏ ูุฑุงุฌุนุชูุง ุจุงุณุชูุฑุงุฑ.</p>
    </section>

    <!-- ุดูุงุฏุฉ ุงูุฅูุฌุงุฒ -->
    <section class="card">
      <h3>ุดูุงุฏุฉ ุงูุฅูุฌุงุฒ</h3>
      <p>
        ุนูุฏ ุงููุตูู ุฅูู ุชูุฏูู ุฌูุฏ ูู ุงูุชุทุจูู ููููู ุชุญููู ุดูุงุฏุฉ ุฅูุฌุงุฒ ุจุตูุบุฉ PDF
        ููุดุงุฑูุชูุง ูุน ุฃุตุฏูุงุฆู ุฃู ูุนููู.
      </p>
      <button class="primary-btn" id="download-cert" ${
        canDownloadCertificate ? '' : 'disabled'
      }>
        ุชุญููู ุดูุงุฏุฉ ุงูุฅูุฌุงุฒ PDF
      </button>
      ${
        canDownloadCertificate
          ? '<p class="muted small">๐ ุฑุงุฆุน! ููููู ุงูุขู ุชุญููู ุงูุดูุงุฏุฉ ูุฃู ุชูุฏููู 60ูช ุฃู ุฃูุซุฑ.</p>'
          : '<p class="muted small">ุชุญุชุงุฌ ูููุตูู ุฅูู <strong>60ูช</strong> ูู ุงูุฏุฑูุณ ุนูู ุงูุฃูู ูุชุญููู ุงูุดูุงุฏุฉ.</p>'
      }
    </section>
  `;

  // ุฑุจุท ุฒุฑ ุงูุดูุงุฏุฉ
  const certBtn = document.getElementById('download-cert');
  if (certBtn && canDownloadCertificate) {
    certBtn.addEventListener('click', () => {
      downloadCertificatePdf(percent);
    });
  }
}

// ุชุนุจุฆุฉ ุจูุงูุงุช ุงูุดูุงุฏุฉ (ุงุณู ุงูุทุงูุจ + ุงููุฑุญูุฉ + ุงุณู ุงููุดุฑูุฉ)
function fillCertificateData(targetDocument) {
  const profile = loadUserProfile() || {};
  const doc = targetDocument || document;

  const nameEl = doc.getElementById('cert-student-name');
  const gradeEl = doc.getElementById('cert-student-grade');
  const teacherEl = doc.getElementById('cert-teacher-name');

  if (nameEl) {
    nameEl.textContent = profile.name || 'ุงุณู ุงูุทุงูุจ';
  }

  if (gradeEl) {
    gradeEl.textContent = profile.grade ? `ุงููุฑุญูุฉ: ${profile.grade}` : '';
  }

  if (teacherEl) {
    teacherEl.textContent = 'ุงูุฃุณุชุงุฐุฉ ุณูุงู ุบุงุฒู';
  }
}

// ุฅูุดุงุก ุดูุงุฏุฉ ุฅูุฌุงุฒ PDF
function downloadCertificatePdf(percent) {
  const { completed, total } = getProgress();
  const profile = loadUserProfile() || {};
  const studentName = profile.name || 'ุงุณู ุงูุทุงูุจ';
  const gradeText = profile.grade ? `ุงููุฑุญูุฉ: ${profile.grade}` : '';

  const html = `
    <!doctype html>
    <html lang="ar" dir="rtl">
      <head>
        <meta charset="utf-8" />
        <title>ุดูุงุฏุฉ ุฅูุฌุงุฒ - ุงููุญู ุจุจุณุงุทุฉ</title>
        <style>
          body {
            font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
            background: #ecfdf5;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
          }
          .cert {
            background: white;
            border-radius: 16px;
            padding: 32px 40px;
            border: 3px solid #10b981;
            box-shadow: 0 20px 40px rgba(16,185,129,0.25);
            width: 800px;
            max-width: 100%;
            text-align: center;
          }
          .cert-title {
            font-size: 28px;
            margin-bottom: 8px;
            color: #065f46;
          }
          .cert-subtitle {
            font-size: 18px;
            margin-bottom: 24px;
            color: #047857;
          }
          .cert-name {
            font-size: 24px;
            margin: 16px 0;
          }
          .cert-info {
            font-size: 16px;
            margin: 8px 0;
          }
          .cert-footer {
            margin-top: 32px;
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #6b7280;
          }
          .cert-brand {
            font-weight: 600;
            color: #10b981;
          }
        </style>
      </head>
      <body>
        <div class="cert">
          <div class="cert-title">ุดูุงุฏุฉ ุฅูุฌุงุฒ</div>
          <div class="cert-subtitle">ุชุทุจูู "ุงููุญู ุจุจุณุงุทุฉ"</div>

          <p class="cert-info">ุชูููุญ ูุฐู ุงูุดูุงุฏุฉ ูู</p>
          <p class="cert-name" id="cert-student-name">${studentName}</p>
          <p class="cert-info" id="cert-student-grade">${gradeText}</p>

          <p class="cert-info">
            ุชูุฏูุฑุงู ูุงุฌุชูุงุฏู ูู ุฏุฑุงุณุฉ ููุงุนุฏ ุงููุญู ูุฅููุงูู
            <strong>${completed}</strong> ูู
            <strong>${total}</strong> ุฏุฑุณูุง
            ุจูุณุจุฉ ุชูุฏูู
            <strong>${percent}ูช</strong>.
          </p>

          <p class="cert-info">
            ุงูููุงุท ุงูููุชุณุจุฉ ุฏุงุฎู ุงูุชุทุจูู: <strong>${appState.points}</strong> ููุทุฉ.
          </p>

          <div class="cert-footer">
            <span>
              ุงููุดุฑูุฉ ุนูู ุงูุชุทุจูู:
              <strong id="cert-teacher-name">ุงูุฃุณุชุงุฐุฉ ุณูุงู ุบุงุฒู</strong>
            </span>
            <span class="cert-brand">ุชุทุจูู ุงููุญู ุจุจุณุงุทุฉ</span>
          </div>
        </div>
      </body>
    </html>
  `;

  const w = window.open('', '_blank');
  if (!w) {
    alert('ุชุนุฐุฑ ูุชุญ ูุงูุฐุฉ ุฌุฏูุฏุฉุ ูุฏ ูููู ุงููุชุตูุญ ุญุธุฑ ุงูููุงูุฐ ุงูููุจุซูุฉ.');
    return;
  }
  w.document.open();
  w.document.write(html);
  w.document.close();
  w.focus();
  w.onload = () => {
    // ุชุฃูุฏ ุฃู ุงูุจูุงูุงุช ูุญุฏุซุฉ ุญุณุจ ุขุฎุฑ ููู ุดุฎุตู
    fillCertificateData(w.document);
    w.print();
  };
}

// =============================
// 12) ุตูุญุฉ "ุงุณุฃู ุงููุนูู"
// =============================

function renderAskTeacherView() {
  const view = document.getElementById('view-ask');
  if (!view) return;

  view.innerHTML = `
    <header class="app-header">
      <h2>ุงุณุฃู ุงููุนูู</h2>
      <p>ุงูุชุจ ุณุคุงูู ูู ุงููุญู ุฃู ุชูุงุตู ูุจุงุดุฑุฉ ูุน ุงูุฃุณุชุงุฐุฉ ุงููุดุฑูุฉ.</p>
    </header>

    <section class="card">
      <h3>ุณุคุงู ููุฐูุงุก ุงูุงุตุทูุงุนู (ูุฑูุจูุง)</h3>
      <p class="muted">
        ูู ุงููุณุฎุฉ ุงููุงุฏูุฉ ุณูุชู ุฑุจุท ูุฐู ุงูุฎุงูุฉ ุจุฎุฏูุฉ ุฐูุงุก ุงุตุทูุงุนู ุนุจุฑ ุฎุงุฏู ุขููุ
        ุญุชู ูุง ูุนุฑุถ ููุงุชูุญ ุงูู API ูู ุงููุชุตููุญ. ุงูุขู ููููู ุงุณุชุฎุฏุงู ุงูุฎุงูุฉ ููุท
        ูุชุฏููู ุงูุฃุณุฆูุฉ ุงูุชู ุชุฑูุฏ ููุงูุดุชูุง ูุน ุงููุนูู.
      </p>
      <textarea id="ai-question" rows="4" style="width:100%;" placeholder="ุงูุชุจ ุณุคุงูู ููุง..."></textarea>
      <button class="primary-btn" id="ai-send" disabled>
        ุฅุฑุณุงู (ุบูุฑ ููุนูู ุจุนุฏ)
      </button>
    </section>

    <section class="card teacher-contact-card">
      <div class="teacher-contact-header">
        <div>
          <h3>ุชูุงุตู ูุน ุงูุฃุณุชุงุฐุฉ ุงููุดุฑูุฉ</h3>
          <p class="teacher-contact-subtitle">ููุงุณุชูุณุงุฑุงุช ูุงูุฃุณุฆูุฉ ุงููุจุงุดุฑุฉ</p>
        </div>
        <span class="teacher-contact-icon">๐ฌ</span>
      </div>

      <div class="teacher-contact-inner">
        <div class="teacher-avatar">๐ฉโ๐ซ</div>
        <div class="teacher-name">ุงูุฃุณุชุงุฐุฉ/ ุณูุงู ุบุงุฒู</div>
        <div class="teacher-role">ุงููุดุฑูุฉ ุนูู ุงูุชุทุจูู</div>

        <div class="teacher-phone">
          <span class="phone-icon">๐</span>
          <span class="phone-number">+967&nbsp;775&nbsp;392&nbsp;526</span>
        </div>

        <p class="teacher-message">
          ูุฏูู ุณุคุงู ุฃู ุงุณุชูุณุงุฑุ ุชูุงุตู ูุนูุง ูุจุงุดุฑุฉ ุนุจุฑ ุงููุงุชุณุงุจุ
          ูุณูููู ุณุนุฏุงุก ุจูุณุงุนุฏุชู ูู ููู ุงูููุงุนุฏ ุงููุญููุฉ ูุชุฌุงูุฒ ุงูุตุนูุจุงุช.
        </p>

        <a
          class="teacher-whatsapp-btn"
          href="https://wa.me/967775392526"
          target="_blank"
          rel="noopener"
        >
          <span>ุฑุงุณููุง ุนูู ุงููุงุชุณุงุจ</span>
          <span>๐ข</span>
        </a>

        <p class="teacher-note">
          ุฃููุงุช ุงูุฑุฏ: ูู ุงูุณุจุช ุฅูู ุงูุฎููุณุ ูฉ ุตุจุงุญูุง โ ูฅ ูุณุงุกู ๐
        </p>
      </div>
    </section>
  `;
}

// =============================
// 13) ุตูุญุฉ ุงููุชุตุฏุฑูู (ุชุฌุฑูุจูุฉ)
// =============================

function renderLeadersView() {
  const view = document.getElementById('view-leaders');
  if (!view) return;

  const { completed, total } = getProgress();
  const percent = total ? Math.round((completed / total) * 100) : 0;

  view.innerHTML = `
    <header class="app-header">
      <h2>ุงููุชุตุฏุฑูู</h2>
      <p>
        ูุณุชูุจููุง ูููู ุฑุจุท ูุฐู ุงูุตูุญุฉ ุจูุงุนุฏุฉ ุจูุงูุงุช ูุนุฑุถ ูุชุนููููู ุญูููููู.
        ุญุงูููุง ูุนุฑุถ ุชูุฏููู ุฃูุช ูุชุฌุฑุจุฉ ูุญููุฉ.
      </p>
    </header>

    <section class="card">
      <h3>ูุฑูุฒู ุงูุญุงูู (ูุญูููุง)</h3>
      <p>ูุณุจุฉ ุงูุฅููุงู: ${percent}ูช</p>
      <p>ุงูููุงุท: ${appState.points}</p>
      <p class="muted">
        ูููุง ุฃูููุช ุฏุฑูุณูุง ุฃูุซุฑ ูุฑูุนุช ููุงุทูุ ุงุฑุชูุน ูุฑูุฒู ุจูู ุงููุชุนูููู ๐
      </p>
    </section>
  `;
}

// =============================
// 14) ููุฏุงู ุชุฃููุฏ ุงูุฎุฑูุฌ ูู ุงูุฏุฑุณ
// =============================

function showExitConfirmModal(onExit) {
  const modal = document.createElement('div');
  modal.className = 'modal';

  modal.innerHTML = `
    <div class="modal-box modal-exit">
      <button class="modal-close" aria-label="ุฅุบูุงู">ร</button>

      <div class="exit-modal-icon">โจ</div>

      <h3 class="exit-modal-title">ูู ุฃูุช ูุชุฃูุฏุ</h3>
      <p class="exit-modal-text">
        ุงูุนูู ูุญุชุงุฌ ุตุจุฑูุงุ ูุง ุชุชุนุฌูู ุงูุฎุฑูุฌ...
        ูู ุฏูููุฉ ุชุชุนูู ูููุง ุชูุฑูุจู ูู ุงูุฅุชูุงู! ๐
      </p>

      <div class="modal-actions">
        <button class="secondary-btn exit-btn">ุงูุฎุฑูุฌ</button>
        <button class="primary-btn stay-btn">ูุชุงุจุนุฉ ุงูุชุนูู</button>
      </div>
    </div>
  `;

  document.body.appendChild(modal);

  const close = () => {
    if (modal.parentNode) modal.parentNode.removeChild(modal);
  };

  modal.querySelector('.modal-close').addEventListener('click', close);
  modal.querySelector('.stay-btn').addEventListener('click', close);

  modal.querySelector('.exit-btn').addEventListener('click', () => {
    close();
    if (typeof onExit === 'function') onExit();
  });

  modal.addEventListener('click', (e) => {
    if (e.target === modal) close();
  });
}

// =============================
// 15) ููุทุฉ ุงูุจุฏุงูุฉ + ูุงูุฐุฉ ุจูุงูุงุช ุงูุทุงูุจ
// =============================

document.addEventListener('DOMContentLoaded', () => {
  loadState();

  const landing = document.getElementById('landing');
  const startBtn = document.getElementById('start-learning');
  const appRoot = document.getElementById('app-root');

  // ุนูุงุตุฑ ูุงูุฐุฉ ุงูุจูุงูุงุช
  const modal = document.getElementById('user-profile-modal');
  const profileForm = document.getElementById('user-profile-form');
  const nameInput = document.getElementById('profile-name');
  const gradeSelect = document.getElementById('profile-grade');
  const closeBtn = document.getElementById('user-profile-close');

  if (!landing || !startBtn || !appRoot) return;

  function buildShellIfNeeded() {
    if (!appRoot.dataset.shellBuilt) {
      buildAppShell();
      appRoot.dataset.shellBuilt = '1';
    }
  }

  function goToLessonsView() {
    landing.classList.add('hidden');
    appRoot.classList.remove('hidden');
    buildShellIfNeeded();
    switchView('lessons');
  }

  function openProfileModal() {
    if (!modal) {
      // ูู ูุง ูุงู ุงูููุฏุงู ููุฌูุฏ ูุฃู ุณุจุจ โ ุงุฏุฎู ูุจุงุดุฑุฉ
      goToLessonsView();
      return;
    }
    modal.classList.remove('hidden');
    if (nameInput) nameInput.focus();
  }

  function closeProfileModal() {
    if (modal) modal.classList.add('hidden');
  }

  // ุนูุฏ ุงูุถุบุท ุนูู "ุงุจุฏุฃ ุงูุชุนููู"
  startBtn.addEventListener('click', () => {
    const existing = loadUserProfile();
    if (existing && existing.name && existing.grade) {
      // ุนูุฏู ุจูุงูุงุช ูุญููุธุฉ ูุณุจููุง โ ุงุฏุฎู ูุจุงุดุฑุฉ
      goToLessonsView();
    } else {
      // ุฃูู ูุฑุฉ โ ุงูุชุญ ูุงูุฐุฉ ุงูุจูุงูุงุช
      openProfileModal();
    }
  });

  // ุญูุธ ุจูุงูุงุช ุงูุทุงูุจ ูู ุงูููุฑู
  if (profileForm) {
    profileForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = nameInput ? nameInput.value.trim() : '';
      const grade = gradeSelect ? gradeSelect.value : '';

      if (!name || !grade) {
        if (!name && nameInput) {
          nameInput.focus();
        } else if (gradeSelect) {
          gradeSelect.focus();
        }
        return;
      }

      saveUserProfile({
        name,
        grade,
        createdAt: Date.now()
      });

      closeProfileModal();
      goToLessonsView();
    });
  }

  // ุฒุฑ ุฅุบูุงู ุงูููุฏุงู
  if (closeBtn) {
    closeBtn.addEventListener('click', () => {
      closeProfileModal();
    });
  }

  // ุฅุบูุงู ุนูุฏ ุงูุถุบุท ุนูู ุฎูููุฉ ุงูููุฏุงู
  if (modal) {
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeProfileModal();
      }
    });
  }
});
